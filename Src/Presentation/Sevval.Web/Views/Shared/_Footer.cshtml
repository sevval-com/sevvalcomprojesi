<footer class="footer">
    <div class="footer-container">
        <div class="footer-content footer-contact">
            <h2 class="footer-title">İletişim Bilgileri</h2>
            <p class="footer-info" data-field="address">
                Adres: <span id="footer-address">-</span>
            </p>
            <p class="footer-info" data-field="phone">
                Telefon: <a id="footer-phone" href="#" class="footer-link">-</a>
            </p>
            <p class="footer-info" data-field="email">
                Talep ve Öneri:
                <a id="footer-email" href="#" class="footer-link">-</a>
            </p>
        </div>
        <div id="ETBIS">
            <div id="7788668188421678">
                <a id="etbis-link" href="https://etbis.eticaret.gov.tr/sitedogrulama/7788668188421678" target="_blank">
                    <img id="etbis-img" style='width:100px; height:120px' src="~/images/etbis-placeholder.png" alt="ETBIS" />
                </a>
            </div>
        </div>
        <div class="footer-section">
            <h2 class="footer-title">Bizi Takip Edin</h2>
            <div class="social-icons">
                <a id="footer-social-youtube" href="#" class="social-icon" target="_blank">
                    <img id="footer-social-youtube-img" src="~/images/youtubelogo.webp" alt="YouTube">
                </a>
                <a id="footer-social-instagram" href="#" class="social-icon" target="_blank">
                    <img id="footer-social-instagram-img" src="~/images/instagramlogo.webp" alt="Instagram">
                </a>
                <a id="footer-social-facebook" href="#" class="social-icon" target="_blank">
                    <img id="footer-social-facebook-img" src="~/images/facebooklogo.webp" alt="Facebook">
                </a>
                <a id="footer-social-tikTok" href="#" class="social-icon" target="_blank">
                    <img id="footer-social-tikTok-img" src="~/images/tiktoklogo.webp" alt="TikTok">
                </a>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p>&copy; @DateTime.Now.Year Emlak Sitesi. Tüm Hakları Saklıdır.</p>
    </div>
</footer>

<script>
(function() {
    async function loadFooterData() {
        try {
            const apiBase = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
                ? '/api/proxy'
                : '/api/v1';
            
            const apiResp = await fetch(`${apiBase}/contact-info`);
            let contact = null;
            if (apiResp.ok) {
                const txt = await apiResp.text();
                if (txt && txt.trim() !== '') {
                    try { contact = JSON.parse(txt); } catch(e) { console.warn('Footer contact parse error', e); }
                }
            }

            let overrides = {};
            try {
                const ov = await fetch('/api/contact-info/overrides', { credentials: 'include' });
                if (ov.ok) {
                    const json = await ov.json();
                    if (json.success && json.data) overrides = json.data.overrides || {};
                }
            } catch {}

            const data = (contact && contact.isSuccessfull && contact.data) ? { ...contact.data } : {
                address: '', phone: '', email: '', whatsAppNumber: '', etbisImageData: '', etbisUrl: ''
            };
            Object.keys(overrides).forEach(k => { if (data[k] !== undefined) data[k] = overrides[k] || data[k]; });

            const elAddr = document.getElementById('footer-address');
            const elPhone = document.getElementById('footer-phone');
            const elMail = document.getElementById('footer-email');
            const etbisImg = document.getElementById('etbis-img');
            const etbisLink = document.getElementById('etbis-link');

            if (elAddr) elAddr.textContent = data.address || '-';
            if (elPhone) {
                const raw = (data.phone || '').replace(/\s/g,'');
                const withoutLeadingZero = raw.replace(/^0+/, '');
                elPhone.textContent = data.phone || '-';
                elPhone.href = raw ? `tel:+90${withoutLeadingZero}` : '#';
            }
            if (elMail) {
                elMail.textContent = data.email || '-';
                elMail.href = data.email ? `mailto:${data.email}` : '#';
            }
            if (etbisImg && data.etbisImageData) etbisImg.src = data.etbisImageData;
            if (etbisLink && data.etbisUrl) etbisLink.href = data.etbisUrl;
            
            // Sosyal medya linkleri
            const fallbackUrls = {
                youtube: 'https://www.kisa.link/wmZoa',
                instagram: 'https://www.instagram.com/sevvalcom?igsh=ZThycHI4eXp1dHlw',
                facebook: 'https://www.facebook.com/profile.php?id=61576226942639',
                tikTok: 'https://www.kisa.link/KWiFP'
            };
            
            const youtubeLink = document.getElementById('footer-social-youtube');
            const instagramLink = document.getElementById('footer-social-instagram');
            const facebookLink = document.getElementById('footer-social-facebook');
            const tiktokLink = document.getElementById('footer-social-tikTok');
            
            if (youtubeLink) youtubeLink.href = data.youtubeUrl || fallbackUrls.youtube;
            if (instagramLink) instagramLink.href = data.instagramUrl || fallbackUrls.instagram;
            if (facebookLink) facebookLink.href = data.facebookUrl || fallbackUrls.facebook;
            if (tiktokLink) tiktokLink.href = data.tikTokUrl || fallbackUrls.tikTok;
        } catch (err) {
            console.warn('Footer data load error:', err);
            
            const fallbackUrls = {
                youtube: 'https://www.kisa.link/wmZoa',
                instagram: 'https://www.instagram.com/sevvalcom?igsh=ZThycHI4eXp1dHlw',
                facebook: 'https://www.facebook.com/profile.php?id=61576226942639',
                tikTok: 'https://www.kisa.link/KWiFP'
            };
            
            const youtubeLink = document.getElementById('footer-social-youtube');
            const instagramLink = document.getElementById('footer-social-instagram');
            const facebookLink = document.getElementById('footer-social-facebook');
            const tiktokLink = document.getElementById('footer-social-tikTok');
            
            if (youtubeLink) youtubeLink.href = fallbackUrls.youtube;
            if (instagramLink) instagramLink.href = fallbackUrls.instagram;
            if (facebookLink) facebookLink.href = fallbackUrls.facebook;
            if (tiktokLink) tiktokLink.href = fallbackUrls.tikTok;
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadFooterData);
    } else {
        loadFooterData();
    }
})();
</script>
