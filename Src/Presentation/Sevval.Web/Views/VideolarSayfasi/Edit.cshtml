@model Sevval.Web.Models.VideoEditViewModel
@{
    ViewData["Title"] = "Video Düzenle";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="min-h-screen bg-slate-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl w-full space-y-8">
        <div class="bg-white p-8 md:p-10 rounded-2xl shadow-2xl">
            <div class="text-center mb-8">
                <i class="fas fa-edit text-5xl text-blue-600"></i>
                <h1 class="mt-4 text-3xl font-extrabold text-slate-900 tracking-tight">Video Düzenle</h1>
                <p class="mt-2 text-sm text-slate-600">Mevcut videonun detaylarını güncelleyin.</p>
            </div>
            <div asp-validation-summary="ModelOnly" class="text-red-600 bg-red-100 p-4 rounded-lg mb-6"></div>
            <form asp-action="Edit" method="post" enctype="multipart/form-data" class="space-y-8">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Id" />
                <fieldset class="space-y-6">
                    <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Video Detayları</legend>
                    <div>
                        <label asp-for="VideoAdi" class="form-label">Başlık</label>
                        <input asp-for="VideoAdi" class="form-input" maxlength="200">
                        <span class="text-xs text-slate-500">Maksimum 200 karakter</span>
                        <span asp-validation-for="VideoAdi" class="form-error"></span>
                    </div>
                    <div>
                        <label asp-for="VideoAciklamasi" class="form-label">Açıklama</label>
                        <textarea asp-for="VideoAciklamasi" rows="5" class="form-input w-full" maxlength="1000"></textarea>
                        <span class="text-xs text-slate-500">Maksimum 1000 karakter</span>
                        <span asp-validation-for="VideoAciklamasi" class="form-error"></span>
                    </div>
                    <div>
                        <label asp-for="Kategori" class="form-label">Kategori</label>
                        <select asp-for="Kategori" id="categorySelect" class="form-input">
                            <option value="" selected>Bir kategori seçin...</option>
                        </select>
                        <span asp-validation-for="Kategori" class="form-error"></span>
                    </div>
                </fieldset>
                <fieldset class="space-y-6">
                    <legend class="text-lg font-semibold text-slate-800 border-b border-slate-200 pb-2 mb-4 w-full">Dosyalar</legend>
                    <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <h3 class="font-medium text-slate-800 mb-4">Yeni Video Kaynağı (opsiyonel)</h3>
                        <label class="form-label">Bilgisayardan Yükle</label>
                        <input type="file" asp-for="VideoDosyasi" id="video-upload-input" class="form-file" accept="video/*" />
                        <div class="my-4 text-center text-sm font-semibold text-slate-400">VEYA</div>
                        <label asp-for="YouTubeLink" class="form-label">YouTube Linki</label>
                        <input asp-for="YouTubeLink" class="form-input">
                        <p class="text-xs text-slate-500 mt-1">Boş bırakırsanız mevcut video korunur.</p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <label class="form-label">Kapak Fotoğrafı (opsiyonel)</label>
                        <input type="file" asp-for="KapakFotografi" id="cover-upload-input" accept="image/*" class="form-file" />
                        @if (!string.IsNullOrWhiteSpace(Model.ExistingCoverPath))
                        {
                            <div class="mt-3">
                                <span class="text-xs text-slate-500">Mevcut kapak:</span>
                                <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden bg-slate-200 mt-1">
                                    <img src="@Url.Content(Model.ExistingCoverPath)" class="w-full h-full object-cover" />
                                </div>
                            </div>
                        }
                    </div>
                </fieldset>
                <div class="flex items-center justify-center gap-3">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-full shadow-lg">
                        Kaydet
                    </button>
                    <a href="@Url.Action("Index")" class="text-slate-600 hover:text-slate-800">İptal</a>
                </div>
            </form>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            populateCategoriesDropdown('@(Model?.Kategori ?? "")');
        });
        async function populateCategoriesDropdown(selected){
            try {
                const sel = document.getElementById('categorySelect');
                if (!sel) return;
                const res = await fetch('/Category/GetCategories');
                const data = await res.json();
                if (!data.success) return;
                const items = data.categories || [];
                sel.innerHTML = '<option value="">Bir kategori seçin...</option>' + items.map(c => `<option value="${escapeHtml(c.name)}">${escapeHtml(c.name)}</option>`).join('');
                // Öncelik: Model'den gelen selected; boşsa URL parametresi
                if (selected) {
                    sel.value = selected;
                } else {
                    const urlParams = new URLSearchParams(window.location.search);
                    const qsKat = urlParams.get('kategori') || urlParams.get('category') || '';
                    const normalize = s => (s || '').toString().trim().replace(/\.$/, '');
                    const target = normalize(qsKat);
                    if (target) {
                        const opt = Array.from(sel.options).find(o => normalize(o.value).toLowerCase() === target.toLowerCase());
                        if (opt) sel.value = opt.value;
                    }
                }
            } catch(e) { console.error(e); }
        }
        function escapeHtml(str){
            return (str||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');
        }
    </script>
}

