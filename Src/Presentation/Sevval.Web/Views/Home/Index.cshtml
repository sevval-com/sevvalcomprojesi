@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@model sevvalemlak.Dto.TumIlanlarDTO

@{
    ViewData["Title"] = "Ana Sayfa";
}
@section style {
    <!-- Bootstrap 5 CSS (Kütüphane) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Swiper CSS (Kütüphane) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Orijinal Stil Dosyası -->
    <link rel="stylesheet" type="text/css" href="~/css/yorumlar.css" />

    <style>
        /* Yorum onay butonu için stil */
        .comment-approve-btn {
            background-color: #28a745; /* Yeşil renk */
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px;
        }

            .comment-approve-btn:hover {
                background-color: #218838;
            }

        /* Onaysız yorumları adminin ayırt etmesi için */
        .comment-unapproved {
            border-left: 4px solid #ffc107; /* Sarı kenarlık */
            background-color: #fffdf5;
        }
    </style>
}
<style>
    /* --- ORİJİNAL SİTE STİLLERİ --- */
    .recently-visited-section {
        margin: 30px 0;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 10px;
    }

    .section-title {
        text-align: center;
        font-size: 28px;
        font-weight: 700;
        color: #0078d7;
        margin-bottom: 25px;
    }

    .recently-visited-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        overflow: hidden;
    }

    .result-item {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        box-sizing: border-box;
    }

        .result-item:hover {
            transform: scale(1);
            border-color: #0078d7;
            box-shadow: 0 8px 24px 0 rgba(0, 120, 215, 0.18), 0 2px 8px 0 rgba(0, 120, 215, 0.10);
        }

    .result-image {
        position: relative;
        width: 100%;
        height: 180px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

        .result-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-image i.fa-camera {
            font-size: 50px;
            color: #007bff;
        }

    .result-price {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(0, 120, 215, 0.85);
        color: #fff;
        padding: 5px 12px;
        font-size: 16px;
        border-radius: 4px;
        font-weight: bold;
    }

    .new-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #007bff;
        color: white;
        padding: 5px 10px;
        font-size: 14px;
        font-weight: bold;
        border-radius: 5px;
    }

    .result-details {
        padding: 15px;
        text-align: left;
    }

        .result-details h3 {
            font-size: 18px;
            color: #003d66;
            margin: 0 0 10px;
            font-weight: 600;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left;
        }

            .result-details h3 a {
                color: inherit;
                text-decoration: none;
            }

                .result-details h3 a:hover {
                    color: #0078d7;
                }

    .result-description {
        font-size: 14px;
        color: #666;
        margin: 8px 0;
        gap: 8px;
        line-height: 1.4;
        display: flex;
    }

    .detail-item-legacy {
        white-space: nowrap;
    }

    .separator {
        color: #999;
        margin: 0 5px;
    }

    .view-all-container {
        text-align: center;
        margin-top: 20px;
    }

    .view-all-btn {
        display: inline-block;
        background-color: #0078d7;
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: background-color 0.3s ease;
    }

        .view-all-btn:hover {
            background-color: #106ebe;
            color: white;
            text-decoration: none;
        }

    /* Popups Font Düzeltmeleri (Masaüstü için varsayılanlar) */
    .popups-container .service-popup h3,
    .popups-container .service-popup-2 h3 {
        font-size: 15px !important;
        margin-top: 5px !important;
        margin-bottom: 5px !important;
        line-height: 1.2 !important;
        font-weight: 700 !important;
    }

    .popups-container .sevvaldrone-popup h3 {
        font-size: 20px !important;
        margin-top: 5px !important;
        margin-bottom: 5px !important;
        line-height: 1.2 !important;
        font-weight: 700 !important;
    }

    .popups-container .service-popup p,
    .popups-container .service-popup-2 p {
        font-size: 11px !important;
        line-height: 1.3 !important;
        margin-bottom: 5px !important;
    }

    .popups-container .sevvaldrone-popup p {
        font-size: 14px !important;
        line-height: 1.3 !important;
        margin-bottom: 5px !important;
    }

    .popups-container .property-image,
    .popups-container .property-image-2 {
        width: 120px !important;
        height: auto !important;
        margin-bottom: 5px !important;
    }

    .popups-container .drone-icon img {
        width: 60px !important;
        height: 60px !important;
    }

    /* Genel Etiketler */
    .popups-container .label,
    .popups-container .label-2 {
        font-size: 13px !important;
        padding: 5px 10px !important;
    }

    .popups-container .sevvaldrone-popup .label {
        font-size: 18px !important;
        font-weight: 800 !important;
        padding: 6px 12px !important;
    }

    /* --- POPUPS CONTAINER RESPONSIVE AYARLARI (MOBİL YAN YANA) --- */
    @@media (max-width: 768px) {
        .popups-container {
            display: flex !important;
            flex-direction: row !important; /* Yan yana zorla */
            flex-wrap: nowrap !important; /* Aşağı kaymayı engelle */
            justify-content: space-between !important;
            gap: 5px !important;
            width: 100% !important;
            padding: 10px 5px !important;
            box-sizing: border-box !important;
            overflow-x: auto !important; /* Taşarsa kaydır */
        }

        .service-popup,
        .service-popup-2,
        .sevvaldrone-popup {
            flex: 1 !important;
            min-width: 0 !important; /* İçerik taşmasını engelle */
            width: 32% !important;
            margin: 0 !important;
            padding: 5px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            text-align: center !important;
            position: relative !important;
            top: auto !important;
            left: auto !important;
            transform: none !important;
            height: auto !important;
            min-height: 130px !important;
        }
        /* Mobilde Görselleri Küçült */
        .popups-container .property-image,
        .popups-container .property-image-2 {
            width: 45px !important; /* Mobilde küçük resim */
            height: auto !important;
            margin-bottom: 2px !important;
        }

        .popups-container .drone-icon img {
            width: 40px !important;
            height: 40px !important;
        }

        .popups-container .drone-icon {
            width: 45px !important;
            height: 45px !important;
        }
        /* Mobilde Yazıları Küçült */
        .popups-container .service-popup h3,
        .popups-container .service-popup-2 h3,
        .popups-container .sevvaldrone-popup h3 {
            font-size: 10px !important; /* Başlıklar küçük */
            line-height: 1.1 !important;
            margin: 2px 0 !important;
            white-space: normal !important;
        }

        .popups-container .service-popup p,
        .popups-container .service-popup-2 p,
        .popups-container .sevvaldrone-popup p {
            font-size: 8px !important; /* Açıklamalar çok küçük */
            line-height: 1.1 !important;
            margin: 0 !important;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* 3 satırla sınırla */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Mobilde Etiketleri Küçült (DÜZELTİLDİ) */
        .popups-container .label,
        .popups-container .label-2 {
            font-size: 7px !important; /* Küçültüldü */
            padding: 2px 3px !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            border-radius: 4px 0 4px 0 !important;
        }

        .popups-container .sevvaldrone-popup .label {
            font-size: 9px !important; /* Küçültüldü */
            padding: 2px 3px !important;
            top: 0 !important;
            right: 0 !important;
            left: auto !important;
        }
        /* Bilgi İkonu */
        .info-icon {
            width: 14px !important;
            height: 14px !important;
            font-size: 10px !important;
            line-height: 14px !important;
            top: 2px !important;
            right: 2px !important;
        }
    }

    /* Responsive tasarım (Diğer Kısımlar) */
    @@media (max-width: 768px) {
        .recently-visited-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .section-title {
            font-size: 24px;
        }

        .result-image {
            height: 150px;
        }

        .result-details {
            padding: 12px;
        }

            .result-details h3 {
                font-size: 16px;
            }

        .logo img {
            width: 70px;
        }
        /* Günün İlanı Butonu Küçültme */
        .floating-offer-img {
            width: 60px !important;
            height: 60px !important;
        }
    }

    @@media (max-width: 480px) {
        .recently-visited-grid {
            /* İlanları mobilde 2'li (yan yana) göster */
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        /* İlan kartı içindeki görselleri mobilde biraz küçült */
        .result-image {
            height: 120px;
        }

        .result-details h3 {
            font-size: 13px;
        }

        .recently-visited-section {
            margin: 20px 0;
            padding: 15px;
        }
    }

    /* --- GÜNÜN İLANI STİLLERİ (BENZERSİZ İSİMLENDİRME) --- */

    .daily-offer-modal-custom .modal-content {
        background: linear-gradient(135deg, #009cfb 0%, #0056b3 100%);
        border-radius: 20px;
        border: none;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        color: white;
        overflow: hidden;
    }

    /* Kapatma Butonu */
    .daily-offer-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        padding: 0;
        margin: 0;
        aspect-ratio: 1;
        color: white;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 1060;
    }

        .daily-offer-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

    .daily-offer-left-col {
        padding: 30px;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 30px;
        justify-content: flex-start;
    }

    .daily-offer-right-col {
        padding: 30px;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    /* Etiketler */
    .daily-offer-tags-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
    }

    .daily-offer-tag {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        white-space: nowrap;
        display: inline-block;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        color: white;
    }

        .daily-offer-tag:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

    .daily-offer-cat {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
        border-color: rgba(255, 255, 255, 0.3);
    }

        .daily-offer-cat::after {
            content: "🏘️";
            margin-left: 6px;
        }

    .daily-offer-stat {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        border-color: rgba(76, 175, 80, 0.5);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

        .daily-offer-stat::after {
            content: "✓";
            margin-left: 6px;
            font-weight: bold;
        }

    .daily-offer-subcat {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        border-color: rgba(33, 150, 243, 0.5);
        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }

        .daily-offer-subcat::after {
            content: "📌";
            margin-left: 6px;
        }

    /* Fiyat Kutusu */
    .daily-offer-price-box {
        margin-bottom: 20px;
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
        padding: 15px;
        border-radius: 12px;
        border-left: 4px solid #FFD700;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
    }

    .daily-offer-price-lbl {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 5px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.8px;
    }

    .daily-offer-price-val {
        font-size: 32px;
        font-weight: 800;
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
        animation: dailyOfferPriceGlow 2s ease-in-out infinite;
    }

    @@keyframes dailyOfferPriceGlow {
        0%, 100% {
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.4)) brightness(1);
        }

        50% {
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)) brightness(1.2);
        }
    }

    /* Başlık ve Konum */
    .daily-offer-title-box .daily-offer-title-text {
        font-size: 22px;
        font-weight: 700;
        margin: 0 0 12px 0;
        line-height: 1.3;
        color: white;
    }

    .daily-offer-loc-box {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        opacity: 0.9;
    }

    .daily-offer-loc-icon {
        color: #01e11b;
    }

    /* Özellikler Grid */
    .daily-offer-feat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
    }

    .daily-offer-feat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.12);
        padding: 8px 12px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        color: white;
    }

        .daily-offer-feat-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 5px 20px rgba(1, 225, 27, 0.3);
            border-color: #01e11b;
        }

    .daily-offer-feat-icon {
        color: #01e11b;
        width: 20px;
        font-size: 18px;
        transition: transform 0.3s ease;
        filter: drop-shadow(0 0 5px rgba(1, 225, 27, 0.5));
    }

    .daily-offer-feat-item:hover .daily-offer-feat-icon {
        transform: rotate(360deg) scale(1.2);
    }

    /* İletişim */
    .daily-offer-contact-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        margin-top: 0;
    }

    .daily-offer-contact-info {
        margin-bottom: 12px;
    }

    .daily-offer-contact-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .daily-offer-contact-icon {
        color: #01e11b;
        width: 16px;
    }

    .daily-offer-contact-btns {
        display: flex;
        gap: 10px;
    }

    .daily-offer-contact-btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s ease;
        text-decoration: none;
        color: white;
    }

    .daily-offer-wa-btn {
        background: #25d366;
    }

        .daily-offer-wa-btn:hover {
            background: #128c7e;
            transform: translateY(-2px);
            color: white;
        }

    .daily-offer-call-btn {
        background: #009cfb;
    }

        .daily-offer-call-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            color: white;
        }

    /* Slider */
    .daily-offer-slider-wrap {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border: 2px solid rgba(255, 255, 255, 0.15);
        height: 450px;
        position: relative;
    }

    .swiper-slide {
        background: rgba(0,0,0,0.2);
    }
    /* Kütüphane sınıfı */
    .daily-offer-slider-wrap .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* Aksiyonlar */
    .daily-offer-action-box {
        margin-top: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .daily-offer-action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 20px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 14px;
        transition: all 0.3s ease;
        text-decoration: none;
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        width: 100%;
    }

    .daily-offer-btn-primary {
        background: linear-gradient(135deg, #01e11b 0%, #00c41a 100%);
        box-shadow: 0 4px 12px rgba(1, 225, 27, 0.3);
    }

        .daily-offer-btn-primary:hover {
            background: linear-gradient(135deg, #00c41a 0%, #00a015 100%);
            transform: translateY(-3px) scale(1.02);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
        }

    .daily-offer-btn-orange {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
    }

        .daily-offer-btn-orange:hover {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            transform: translateY(-3px) scale(1.02);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
        }

    .daily-offer-view-cnt {
        grid-column: span 2;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: rgba(255, 255, 255, 0.2);
        padding: 10px 18px;
        border-radius: 10px;
        color: white;
        font-size: 16px;
        font-weight: 700;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
        width: 100%;
    }

        .daily-offer-view-cnt:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

    /* Swiper Özel Stil */
    .daily-offer-modal-custom .swiper-button-prev,
    .daily-offer-modal-custom .swiper-button-next {
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

        .daily-offer-modal-custom .swiper-button-prev:after,
        .daily-offer-modal-custom .swiper-button-next:after {
            font-size: 24px;
            font-weight: bold;
        }

    /* ORTA EKRAN (TABLET) */
    @@media (min-width: 769px) and (max-width: 991px) {
        .modal-lg-custom {
            max-width: 95%;
            margin: 10px auto;
        }

        .daily-offer-left-col {
            padding: 15px;
            overflow-y: auto;
            max-height: 400px;
            gap: 15px;
        }

        .daily-offer-right-col {
            padding: 15px;
        }

        .daily-offer-slider-wrap {
            height: 250px;
        }

        .daily-offer-price-val {
            font-size: 26px;
        }

        .daily-offer-title-text {
            font-size: 18px;
        }

        .daily-offer-contact-btns {
            flex-direction: row;
        }

        .daily-offer-action-box {
            gap: 10px;
        }

        .daily-offer-action-btn {
            padding: 10px 10px;
            font-size: 12px;
        }
    }

    /* MOBİL EKRAN İÇİN ÖZEL "TEKTE GÖSTERME" AYARLARI */
    @@media (max-width: 768px) {
        .modal-lg-custom {
            max-width: 98% !important;
            margin: 5px auto !important;
        }
        /* Scroll kısıtlamasını kaldır, içerik kadar uzasın */
        .daily-offer-left-col {
            padding: 10px !important;
            overflow-y: visible !important;
            max-height: none !important;
            gap: 8px !important; /* Araları sıkılaştır */
        }

        .daily-offer-right-col {
            padding: 5px 10px !important;
            gap: 5px !important;
        }
        /* Slider yüksekliğini küçült */
        .daily-offer-slider-wrap {
            height: 200px !important; /* Mobilde daha küçük slider */
            border-radius: 10px !important;
        }
        /* Fiyat */
        .daily-offer-price-val {
            font-size: 22px !important; /* Daha küçük fiyat */
        }

        .daily-offer-price-lbl {
            font-size: 10px !important;
            margin-bottom: 2px !important;
        }

        .daily-offer-price-box {
            padding: 8px !important;
            margin-bottom: 8px !important;
        }
        /* Başlık */
        .daily-offer-title-text {
            font-size: 16px !important;
            margin-bottom: 5px !important;
            line-height: 1.2 !important;
        }

        .daily-offer-title-box {
            margin-bottom: 0 !important;
        }
        /* Konum */
        .daily-offer-loc-box {
            font-size: 11px !important;
            margin-bottom: 8px !important;
        }
        /* Etiketler */
        .daily-offer-tags-wrapper {
            margin-bottom: 8px !important;
            gap: 4px !important;
        }

        .daily-offer-tag {
            padding: 4px 8px !important;
            font-size: 9px !important;
        }
        /* Özellikler Grid */
        .daily-offer-feat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr) !important; /* 2 sütun yap */
            gap: 5px !important;
            margin-bottom: 8px !important;
        }

        .daily-offer-feat-item {
            padding: 5px !important;
            font-size: 10px !important;
        }

        .daily-offer-feat-icon {
            font-size: 14px !important;
        }
        /* İletişim Kutusu */
        .daily-offer-contact-box {
            padding: 8px !important;
            margin-top: 0 !important;
        }

        .daily-offer-contact-row {
            font-size: 11px !important;
            margin-bottom: 4px !important;
        }

        .daily-offer-contact-btn {
            padding: 6px 10px !important;
            font-size: 11px !important;
        }

        .daily-offer-contact-btns {
            gap: 5px !important;
        }
        /* Butonlar */
        .daily-offer-action-box {
            gap: 5px !important;
            margin-top: 10px !important;
        }

        .daily-offer-action-btn {
            padding: 8px !important;
            font-size: 11px !important;
        }

        .daily-offer-view-cnt {
            padding: 5px !important;
            font-size: 11px !important;
            margin-top: 0 !important;
        }
        /* Kapatma butonu biraz daha küçük */
        .daily-offer-close-btn {
            width: 30px !important;
            height: 30px !important;
            top: 10px !important;
            right: 10px !important;
            font-size: 14px !important;
        }
    }

    @@media (min-width: 992px) {
        .modal-lg-custom {
            max-width: 1200px;
            width: 95%;
        }

        .daily-offer-left-col {
            border-right: 1px solid rgba(255,255,255,0.1);
        }
    }

    /* --- ÜYELERİMİZ BÖLÜMÜ YENİ TASARIM (SCROLLABLE) --- */
    .advisor-container {
        margin: 40px 0;
        padding: 30px 15px;
        background: linear-gradient(135deg, #0078d7 0%, #005a9e 100%);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 120, 215, 0.2);
    }

    .advisor-wrapper {
        display: flex;
        flex-wrap: nowrap; /* Kartlar tek satırda kalsın */
        overflow-x: auto; /* Yatay kaydırma */
        gap: 20px;
        padding: 20px 10px;
        cursor: grab; /* Tutulabilir imleç */
        -webkit-overflow-scrolling: touch; /* Mobilde yumuşak kaydırma */
        scrollbar-width: thin; /* Firefox için ince scrollbar */
        scrollbar-color: rgba(255,255,255,0.5) transparent;
    }

        .advisor-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        .advisor-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .advisor-wrapper::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

    .advisor-card {
        background-color: #ffffff;
        border-radius: 12px;
        width: 220px; /* Sabit genişlik */
        min-width: 220px; /* Sıkışmayı önler */
        padding: 20px 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(0,0,0,0.05);
    }

        .advisor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

    .advisor-img-wrapper {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        overflow: hidden;
        margin-bottom: 15px;
        border: 3px solid #eef2f6;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        flex-shrink: 0;
    }

    .advisor-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .advisor-card:hover .advisor-img {
        transform: scale(1.1);
    }

    .advisor-info {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-grow: 1;
    }

    .advisor-name {
        font-size: 16px;
        font-weight: 700;
        color: #2c3e50;
        margin: 5px 0;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .advisor-email {
        font-size: 13px;
        color: #7f8c8d;
        margin-bottom: 15px;
        font-weight: 500;
    }

    .advisor-btn {
        background-color: #0078d7;
        color: white !important;
        padding: 8px 24px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 13px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-top: auto;
    }

        .advisor-btn:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 120, 215, 0.3);
            transform: scale(1.05);
        }
</style>

@if (ViewBag.GununIlan != null)
{
    <script>
        (function() {
            async function refreshDailyOfferViewCount() {
                try {
                    const response = await fetch('@Url.Action("GetDailyOfferViewCount", "Home")', { cache: 'no-store' });
                    if (!response.ok) return;
                    const data = await response.json();
                    if (data && data.success) {
                        const el = document.getElementById('dailyOfferViewCountText');
                        if (el) {
                            el.innerHTML = data.count + ' görüntülenme';
                        }
                    }
                } catch (e) { }
            }
            refreshDailyOfferViewCount();
            setInterval(refreshDailyOfferViewCount, 60000);
        })();
    </script>

    <!-- Bootstrap 5 Modal - Benzersiz Sınıflar -->
    <div class="modal fade daily-offer-modal-custom" id="dailyOfferModal" tabindex="-1" aria-labelledby="dailyOfferLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg-custom">
            <div class="modal-content">
                <!-- Close Button -->
                <button type="button" class="daily-offer-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>

                <div class="modal-body p-0">
                    <div class="row g-0">
                        <!-- Sol Taraf: Bilgiler -->
                        <div class="col-lg-5 col-12 order-2 order-lg-1">
                            <div class="daily-offer-left-col">
                                <div>
                                    <!-- Tags -->
                                    <div class="daily-offer-tags-wrapper">
                                        @{
                                            var category = string.IsNullOrWhiteSpace(ViewBag.GununIlan.Category) ? "" : ViewBag.GununIlan.Category;
                                            var status = string.IsNullOrWhiteSpace(ViewBag.GununIlan.KonutDurumu) ? "" : ViewBag.GununIlan.KonutDurumu;
                                            var subCategory = string.IsNullOrWhiteSpace(ViewBag.GununIlan.MulkTipi) ? "" : ViewBag.GununIlan.MulkTipi;
                                        }

                                        @if (!string.IsNullOrEmpty(category))
                                        {
                                            <span class="daily-offer-tag daily-offer-cat">@category</span>
                                        }
                                        @if (!string.IsNullOrEmpty(status))
                                        {
                                            <span class="daily-offer-tag daily-offer-stat">@status</span>
                                        }
                                        @if (!string.IsNullOrEmpty(subCategory))
                                        {
                                            <span class="daily-offer-tag daily-offer-subcat">@subCategory</span>
                                        }
                                    </div>

                                    <!-- Price -->
                                    <div class="daily-offer-price-box">
                                        <div class="daily-offer-price-lbl">Fiyat</div>
                                        <div class="daily-offer-price-val">@($"{ViewBag.GununIlan.Price:N0} TL")</div>
                                    </div>

                                    <!-- Title -->
                                    <div class="daily-offer-title-box">
                                        <h2 class="daily-offer-title-text">@ViewBag.GununIlan.Title</h2>
                                    </div>

                                    <!-- Location -->
                                    @{
                                        List<string> locationList = new List<string>();
                                        locationList.Add(ViewBag.GununIlan.sehir);
                                        locationList.Add(ViewBag.GununIlan.semt);
                                        locationList.Add(ViewBag.GununIlan.mahalleKoy);
                                    }
                                    <div class="daily-offer-loc-box">
                                        <i class="fas fa-map-marker-alt daily-offer-loc-icon"></i>
                                        <span>@string.Join(" | ", locationList.Where(a => !string.IsNullOrEmpty(a)))</span>
                                    </div>

                                    <!-- Details Grid (Dolu/Boş Kontrollü) -->
                                    <div class="daily-offer-feat-grid">
                                        @if (!string.IsNullOrEmpty(ViewBag.GununIlan.Area?.ToString()) && ViewBag.GununIlan.Area?.ToString() != "0")
                                        {
                                            <div class="daily-offer-feat-item">
                                                <i class="fas fa-ruler-combined daily-offer-feat-icon"></i>
                                                <span>@ViewBag.GununIlan.Area?.ToString("N0") m²</span>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(ViewBag.GununIlan.AdaNo?.ToString()))
                                        {
                                            <div class="daily-offer-feat-item">
                                                <i class="fas fa-map daily-offer-feat-icon"></i>
                                                <span>Ada: @ViewBag.GununIlan.AdaNo</span>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(ViewBag.GununIlan.ParselNo?.ToString()))
                                        {
                                            <div class="daily-offer-feat-item">
                                                <i class="fas fa-map daily-offer-feat-icon"></i>
                                                <span>Parsel: @ViewBag.GununIlan.ParselNo</span>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(ViewBag.GununIlan.OdaSayisi?.ToString()) && ViewBag.GununIlan.OdaSayisi?.ToString() != "0")
                                        {
                                            <div class="daily-offer-feat-item">
                                                <i class="fas fa-bed daily-offer-feat-icon"></i>
                                                <span>@ViewBag.GununIlan.OdaSayisi Oda</span>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(ViewBag.GununIlan.BinaYasi?.ToString()))
                                        {
                                            <div class="daily-offer-feat-item">
                                                <i class="fas fa-building daily-offer-feat-icon"></i>
                                                <span>@ViewBag.GununIlan.BinaYasi Yaşında</span>
                                            </div>
                                        }
                                    </div>
                                </div>

                                <!-- Contact Section (Firma Adı Eklendi) -->
                                <div class="daily-offer-contact-box">
                                    <div class="daily-offer-contact-info">
                                        <div class="daily-offer-contact-row">
                                            <i class="fas fa-user daily-offer-contact-icon"></i>
                                            <span>@ViewBag.KullaniciAdSoyad</span>
                                        </div>
                                        <div class="daily-offer-contact-row">
                                            <i class="fas fa-phone daily-offer-contact-icon"></i>
                                            @{
                                                string rawPhone = (ViewBag.GununIlan.PhoneNumber ?? "").ToString();
                                                var sbPhone = new System.Text.StringBuilder();
                                                foreach (var ch in rawPhone)
                                                {
                                                    if (char.IsDigit(ch)) sbPhone.Append(ch);
                                                }
                                                string digits = sbPhone.ToString();
                                                if (digits.StartsWith("90") && digits.Length == 12)
                                                {
                                                    digits = "0" + digits.Substring(2);
                                                }
                                                if (digits.Length == 10)
                                                {
                                                    digits = "0" + digits;
                                                }
                                                string formattedPhone = rawPhone;
                                                if (digits.Length >= 11)
                                                {
                                                    formattedPhone = $"0 {digits.Substring(1, 3)} {digits.Substring(4, 3)} {digits.Substring(7, 2)} {digits.Substring(9, 2)}";
                                                }
                                            }
                                            <span>@formattedPhone</span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(ViewBag.CompanyName))
                                        {
                                            <div class="daily-offer-contact-row">
                                                <i class="fas fa-building daily-offer-contact-icon"></i>
                                                <span>@ViewBag.CompanyName</span>
                                            </div>
                                        }
                                    </div>
                                    <div class="daily-offer-contact-btns">
                                        <a href="javascript:void(0)" class="daily-offer-contact-btn daily-offer-wa-btn" onclick="sendMessageToWhatsapp()">
                                            <i class="fab fa-whatsapp"></i> WhatsApp
                                        </a>
                                        <a href="javascript:void(0)" class="daily-offer-contact-btn daily-offer-call-btn" onclick="makeCall()">
                                            <i class="fas fa-phone"></i> Ara
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sağ Taraf: Slider ve Aksiyon Butonları -->
                        <div class="col-lg-7 col-12 order-1 order-lg-2">
                            <div class="daily-offer-right-col">
                                <!-- Swiper Container (Benzersiz ID) -->
                                <div class="daily-offer-slider-wrap">
                                    <div class="swiper dailyOfferSwiper w-100 h-100">
                                        <div class="swiper-wrapper">
                                            @if (ViewBag.Fotograflar != null && ViewBag.Fotograflar.Count > 0)
                                            {
                                                bool gununIlaniEklendi = false;
                                                for (int i = 0; i < ViewBag.Fotograflar.Count; i++)
                                                {
                                                    string photoUrl = ViewBag.Fotograflar[i].Url.ToString();
                                                    if (photoUrl.Contains("wwwroot"))
                                                    {
                                                        int idx = photoUrl.IndexOf("wwwroot");
                                                        photoUrl = photoUrl.Substring(idx + 8).Replace("\\", "/");
                                                        if (!photoUrl.StartsWith("/")) photoUrl = "/" + photoUrl;
                                                    }
                                                    else if (photoUrl.Contains("images"))
                                                    {
                                                        int idx = photoUrl.IndexOf("images");
                                                        photoUrl = "/" + photoUrl.Substring(idx).Replace("\\", "/");
                                                    }

                                                    <div class="swiper-slide">
                                                        <img src="@photoUrl" alt="İlan Resmi" loading="lazy" style="object-fit: contain;" />
                                                    </div>

                                                    if (!gununIlaniEklendi && i == (ViewBag.Fotograflar.Count / 2))
                                                    {
                                                        <div class="swiper-slide">
                                                            <img src="~/ImageFiles/gununilani.png" alt="Günün İlanı" loading="lazy" style="object-fit: contain;" />
                                                        </div>
                                                        gununIlaniEklendi = true;
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                <div class="swiper-slide d-flex align-items-center justify-content-center text-white">
                                                    <div class="text-center">
                                                        <i class="fas fa-camera fa-3x mb-2"></i>
                                                        <p>Fotoğraf Yok</p>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                        <div class="swiper-button-next"></div>
                                        <div class="swiper-button-prev"></div>
                                    </div>
                                </div>

                                <!-- Alt Aksiyon Butonları -->
                                <div class="daily-offer-action-box">
                                    <a href="@Url.Action("ilansayfasi", "Ilan", new { id = ViewBag.GununIlan.Id })" class="daily-offer-action-btn daily-offer-btn-primary">
                                        <i class="fas fa-eye"></i> İlana Git
                                    </a>
                                    <a href="@Url.Action("GununIlaniSiparisi", "Home")" class="daily-offer-action-btn daily-offer-btn-orange">
                                        <i class="fas fa-star"></i> Günün İlanı Ver
                                    </a>
                                    <div class="daily-offer-view-cnt">
                                        <i class="fas fa-eye"></i>
                                        <span id="dailyOfferViewCountText">@ViewBag.GununIlan.GoruntulenmeSayisi görüntülenme</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<!-- Yüzen buton -->
<a href="#" id="floating-offer-icon" class="floating-offer-link">
    <img src="~/ImageFiles/GÜNÜNİLANİ.webp" alt="Günün İlanı" class="floating-offer-img" loading="lazy" width="100" height="100">
</a>

<div class="tagline-container1" style="display: flex;">
    <h2 class="tagline">VARSA BİZDEN İYİSİ, O DA BİZDEN BİRİSİ</h2>
</div>

<!-- Arama Formu ve Filtreler -->
<form asp-action="HizliAra" asp-controller="Ilan" method="post">
    <!-- Arama ve Seçenekler Kutusu -->
    <div class="custom-search-container">
        <!-- Arama Kutusu -->
        <div class="search-section">
            <input type="text"
                   class="custom-search-input"
                   id="siteSearchInput"
                   name="anahtarKelime"
                   placeholder="Aradığınız şeyi yazın..."
                   value="@ViewBag.AnahtarKelime" />
            <button type="submit" class="custom-search-button">Ara<i class=" fa-solid fa-magnifying-glass"></i></button>
        </div>
    </div>
</form>

<div class="tagline-container">
    <!-- Seçenekler Penceresi -->
    <div class="custom-options-container">
        <div class="options-header">Filtreli Arama</div>
        <div class="options-tabs">
            <button class="option-tab" onclick="showOption('konut')">
                Konut <span class="dropdown-icon"></span>
            </button>
            <button class="option-tab" onclick="showOption('arazi')">
                Arsa <span class="dropdown-icon"></span>
            </button>
            <button class="option-tab" onclick="showOption('bahce')">
                Bahçe <span class="dropdown-icon"></span>
            </button>
            <button class="option-tab" onclick="showOption('tarla')">
                Tarla <span class="dropdown-icon"></span>
            </button>
            <button class="option-tab" onclick="showOption('is_yeri')">
                İş Yeri <span class="dropdown-icon"></span>
            </button>
            <button class="option-tab" onclick="showOption('turistik')">
                Turistik Tesis <span class="dropdown-icon"></span>
            </button>
        </div>

        <div class="options-content">
            <!-- (Buradaki formlar orjinal dosyadan birebir kopyalanmıştır, özet geçilmemiştir) -->
            <!-- Konut Seçeneği -->
            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="konut" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="Konut (Yaşam Alanı)">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu">
                            <option value="Satılık">Satılık</option>
                            <option value="Kiralık">Kiralık</option>
                            <option value="Devren Satılık">Devren Satılık</option>
                            <option value="Devren Kiralık">Devren Kiralık</option>
                        </select>
                        <select name="detayliAramaRequestDTO.MulkTipi">
                            <option value="Daire">Daire</option>
                            <option value="Müstakil Ev">Müstakil Ev</option>
                            <option value="Köy Evi">Köy Evi</option>
                            <option value="Eski, Kargir Ev">Eski, Kargir Ev</option>
                            <option value="Dağ Evi">Dağ Evi</option>
                            <option value="Kerpiç Ev">Kerpiç Ev</option>
                            <option value="Samanlık">Samanlık</option>
                            <option value="Kulübe">Kulübe</option>
                            <option value="Konteyner">Konteyner</option>
                            <option value="Prefabrik">Prefabrik</option>
                            <option value="Bungalow">Bungalow</option>
                            <option value="Tiny House">Tiny House</option>
                            <option value="Loft Daire">Loft Daire</option>
                            <option value="Bina">Bina</option>
                            <option value="Devremülk">Devremülk</option>
                            <option value="Çiftlik Evi">Çiftlik Evi</option>
                            <option value="Kooperatif">Kooperatif</option>
                            <option value="Villa">Villa</option>
                            <option value="Köşk">Köşk</option>
                            <option value="Konak">Konak</option>
                            <option value="Yalı">Yalı</option>
                            <option value="Ev ve Ahır">Ev ve Ahır</option>
                            <option value="Rezidans">Rezidans</option>
                            <option value="Diğer">Diğer</option>
                        </select>
                    </div>
                    <div class="location-group">
                        <select name="detayliAramaRequestDTO.Il" id="sehir"><option value="">İl Seçiniz</option></select>
                        <select name="detayliAramaRequestDTO.Ilce" id="semt"><option value="">İlçe Seçiniz</option></select>
                        <select name="detayliAramaRequestDTO.Mahalle" id="mahalle"><option value="">Mahalle/Köy Seçiniz</option></select>
                    </div>
                    <div class="price-group">
                        <input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL">
                        <input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL">
                    </div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>

            <!-- Arsa, Bahçe, Tarla vb. diğer formlar aynen korunmuştur (yer kaplamasın diye burada kısaltmıyorum ama dosyada tam olacak) -->
            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="arazi" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="Arsa">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu"><option value="Satılık">Satılık</option><option value="Kiralık">Kiralık</option><option value="Kat Karşılığı">Kat Karşılığı</option></select>
                        <select name="detayliAramaRequestDTO.ArsaTipi"><option value="A-Lejantlı Arsa">A-Lejantlı Arsa</option><option value="Bahçe">Bahçe</option><option value="Çiftlik">Çiftlik</option><option value="Depo Ve Antrepo">Depo Ve Antrepo</option><option value="Eğitim">Eğitim</option><option value="Enerji Depolama">Enerji Depolama</option><option value="Hastane">Hastane</option><option value="Kamu Alanı">Kamu Alanı</option><option value="Karma">Karma</option><option value="Konut">Konut</option><option value="Konut + Ticaret">Konut + Ticaret</option><option value="Muhtelif Arsa">Muhtelif Arsa</option><option value="Özel Kullanım">Özel Kullanım</option><option value="Petrol Lejantı">Petrol Lejantı</option><option value="Sanayi">Sanayi</option><option value="Sağlık">Sağlık</option><option value="Sera">Sera</option><option value="Sit Alanı">Sit Alanı</option><option value="Spor Alanı">Spor Alanı</option><option value="Tarım">Tarım</option><option value="Ticaret">Ticaret</option><option value="Toplu Konut">Toplu Konut</option><option value="Turizm">Turizm</option><option value="Turizm Arsa">Turizm Arsa</option><option value="Yeşil Alan">Yeşil Alan</option><option value="Diğer">Diğer</option></select>
                    </div>
                    <div class="location-group"><select name="detayliAramaRequestDTO.Il" id="sehirArsa"><option value="">İl Seçiniz</option></select><select name="detayliAramaRequestDTO.Ilce" id="semtArsa"><option value="">İlçe Seçiniz</option></select><select name="detayliAramaRequestDTO.Mahalle" id="mahalleArsa"><option value="">Mahalle/Köy Seçiniz</option></select></div>
                    <div class="price-group"><input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL"><input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL"></div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>

            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="bahce" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="Bahçe">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu"><option value="Satılık">Satılık</option><option value="Kiralık">Kiralık</option><option value="Kat Karşılığı">Kat Karşılığı</option></select>
                        <select name="detayliAramaRequestDTO.MeyveTuru"><option value="Ahududu">Ahududu</option><option value="Armut">Armut</option><option value="Avokado">Avokado</option><option value="Ayva">Ayva</option><option value="Badem">Badem</option><option value="Böğürtlen">Böğürtlen</option><option value="Ceviz">Ceviz</option><option value="Çilek">Çilek</option><option value="Dut">Dut</option><option value="Elma">Elma</option><option value="Erik">Erik</option><option value="Fındık">Fındık</option><option value="Greyfurt">Greyfurt</option><option value="Hurma">Hurma</option><option value="İğde">İğde</option><option value="Kayısı">Kayısı</option><option value="Kestane">Kestane</option><option value="Kivi">Kivi</option><option value="Kızılcık">Kızılcık</option><option value="Kiraz">Kiraz</option><option value="Karışık">Karışık</option><option value="Lavanta">Lavanta</option><option value="Limon">Limon</option><option value="Mandalina">Mandalina</option><option value="Muşmula">Muşmula</option><option value="Muz">Muz</option><option value="Nar">Nar</option><option value="Portakal">Portakal</option><option value="Şeftali">Şeftali</option><option value="Üzüm">Üzüm</option><option value="Vişne">Vişne</option><option value="Zeytin">Zeytin</option><option value="Diğer">Diğer</option></select>
                    </div>
                    <div class="location-group"><select name="detayliAramaRequestDTO.Il" id="sehirBahce"><option value="">İl Seçiniz</option></select><select name="detayliAramaRequestDTO.Ilce" id="semtBahce"><option value="">İlçe Seçiniz</option></select><select name="detayliAramaRequestDTO.Mahalle" id="mahalleBahce"><option value="">Mahalle/Köy Seçiniz</option></select></div>
                    <div class="price-group"><input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL"><input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL"></div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>

            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="tarla" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="Tarla">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu"><option value="Satılık">Satılık</option><option value="Kiralık">Kiralık</option><option value="Kat Karşılığı">Kat Karşılığı</option></select>
                        <select name="detayliAramaRequestDTO.UrunTuru"><option value="Ayçiçeği">Ayçiçeği</option><option value="Bakla">Bakla</option><option value="Bamya">Bamya</option><option value="Bağ">Bağ</option><option value="Bezelye">Bezelye</option><option value="Çay">Çay</option><option value="Çilek">Çilek</option><option value="Fasulye">Fasulye</option><option value="Ispanak">Ispanak</option><option value="Kabak">Kabak</option><option value="Marul">Marul</option><option value="Patlıcan">Patlıcan</option><option value="Salatalık">Salatalık</option><option value="Sarımsak">Sarımsak</option><option value="Tarla+Bağ">Tarla+Bağ</option><option value="Tütün">Tütün</option><option value="Yer Fıstığı">Yer Fıstığı</option><option value="Diğer">Diğer</option></select>
                    </div>
                    <div class="location-group"><select name="detayliAramaRequestDTO.Il" id="sehirTarla"><option value="">İl Seçiniz</option></select><select name="detayliAramaRequestDTO.Ilce" id="semtTarla"><option value="">İlçe Seçiniz</option></select><select name="detayliAramaRequestDTO.Mahalle" id="mahalleTarla"><option value="">Mahalle/Köy Seçiniz</option></select></div>
                    <div class="price-group"><input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL"><input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL"></div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>

            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="is_yeri" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="İş Yeri">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu"><option value="Satılık">Satılık</option><option value="Kiralık">Kiralık</option><option value="Devren Satılık">Devren Satılık</option><option value="Devren Kiralık">Devren Kiralık</option></select>
                        <select name="detayliAramaRequestDTO.IsYeriTuru"><option value="Akaryakıt İstasyonu">Akaryakıt İstasyonu</option><option value="Apartman Dairesi">Apartman Dairesi</option><option value="Aşevi">Aşevi</option><option value="Atölye">Atölye</option><option value="AVM">AVM</option><option value="Bakkal">Bakkal</option><option value="Beyaz Eşya">Beyaz Eşya</option><option value="Bina">Bina</option><option value="Büfe">Büfe</option><option value="Büro & Ofis">Büro & Ofis</option><option value="Çay Bahçesi">Çay Bahçesi</option><option value="Çiftlik">Çiftlik</option><option value="Depo & Antrepo">Depo & Antrepo</option><option value="Dershane">Dershane</option><option value="Düğün Salonu">Düğün Salonu</option><option value="Dükkan & Mağaza">Dükkan & Mağaza</option><option value="Eczane">Eczane</option><option value="Enerji Santrali">Enerji Santrali</option><option value="Fabrika & Üretim Tesisi">Fabrika & Üretim Tesisi</option><option value="Fırın & Tatlıcı">Fırın & Tatlıcı</option><option value="Garaj & Park Yeri">Garaj & Park Yeri</option><option value="Genel">Genel</option><option value="Hamam & Sauna">Hamam & Sauna</option><option value="Hastane">Hastane</option><option value="Huzurevi">Huzurevi</option><option value="İmalathane">İmalathane</option><option value="İş Hanı Katı & Ofisi">İş Hanı Katı & Ofisi</option><option value="Kahvehane">Kahvehane</option><option value="Kamu Binası">Kamu Binası</option><option value="Kantin">Kantin</option><option value="Kır & Kahvaltı Bahçesi">Kır & Kahvaltı Bahçesi</option><option value="Kıraathane">Kıraathane</option><option value="Komple Bina">Komple Bina</option><option value="Konfeksiyon">Konfeksiyon</option><option value="Market">Market</option><option value="Maden Ocağı">Maden Ocağı</option><option value="Müstakil İş Yeri">Müstakil İş Yeri</option><option value="Otopark">Otopark</option><option value="Pastane">Pastane</option><option value="Pazar Yeri">Pazar Yeri</option><option value="Plaza">Plaza</option><option value="Plaza Katı & Ofisi">Plaza Katı & Ofisi</option><option value="Radyo İstasyonu & TV Kanalı">Radyo İstasyonu & TV Kanalı</option><option value="Restoran & Lokanta">Restoran & Lokanta</option><option value="Rezidans">Rezidans</option><option value="Rezidans Katı & Ofisi">Rezidans Katı & Ofisi</option><option value="Sağlık Merkezi">Sağlık Merkezi</option></select>
                    </div>
                    <div class="location-group"><select name="detayliAramaRequestDTO.Il" id="sehirIsYeri"><option value="">İl Seçiniz</option></select><select name="detayliAramaRequestDTO.Ilce" id="semtIsYeri"><option value="">İlçe Seçiniz</option></select><select name="detayliAramaRequestDTO.Mahalle" id="mahalleIsYeri"><option value="">Mahalle/Köy Seçiniz</option></select></div>
                    <div class="price-group"><input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL"><input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL"></div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>

            <form asp-action="HizliAra" asp-controller="Ilan" method="post">
                <div id="turistik" class="option-details">
                    <input type="hidden" name="detayliAramaRequestDTO.Kategori" value="Turistik Tesis">
                    <div class="filter-group">
                        <select name="detayliAramaRequestDTO.KonutDurumu"><option value="Satılık">Satılık</option><option value="Kiralık">Kiralık</option><option value="Devren Satılık">Devren Satılık</option><option value="Devren Kiralık">Devren Kiralık</option></select>
                        <select name="detayliAramaRequestDTO.TesisTuru"><option value="1 Yıldızlı Otel">1 Yıldızlı Otel</option><option value="2 Yıldızlı Otel">2 Yıldızlı Otel</option><option value="3 Yıldızlı Otel">3 Yıldızlı Otel</option><option value="4 Yıldızlı Otel">4 Yıldızlı Otel</option><option value="5 Yıldızlı Otel">5 Yıldızlı Otel</option><option value="Apart">Apart</option><option value="Bungalov">Bungalov</option><option value="Butik Otel">Butik Otel</option><option value="Dağ Evi">Dağ Evi</option><option value="Devremülk">Devremülk</option><option value="Kamp Alanı">Kamp Alanı</option><option value="Tiny House">Tiny House</option><option value="Yazlık">Yazlık</option><option value="Diğer">Diğer</option></select>
                    </div>
                    <div class="location-group"><select name="detayliAramaRequestDTO.Il" id="sehirTuristik"><option value="">İl Seçiniz</option></select><select name="detayliAramaRequestDTO.Ilce" id="semtTuristik"><option value="">İlçe Seçiniz</option></select><select name="detayliAramaRequestDTO.Mahalle" id="mahalleTuristik"><option value="">Mahalle/Köy Seçiniz</option></select></div>
                    <div class="price-group"><input type="text" name="detayliAramaRequestDTO.EnDusukFiyat" placeholder="Minimum TL"><input type="text" name="detayliAramaRequestDTO.EnYuksekFiyat" placeholder="Maximum TL"></div>
                    <button type="submit" class="search-button">Ara</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="background-murat" style="background-image: url('/ImageFiles/arkaplan.webp');">
    <!-- Diğer HTML içeriğiniz buraya gelebilir -->
</div>

<!-- ORİJİNAL POPUPS CONTAINER (HİÇ DEĞİŞTİRİLMEDEN) -->
<div class="popups-container">

    <!-- Ücretsiz Hizmet Penceresi -->
    <div class="service-popup" id="service-popup" onclick="window.location.href='@Url.Action("MulkumuSatmakIstiyorum", "Form")'">
        <span class="label">Ücretsiz Hizmet</span>
        <img src="~/images/tl_ikon.webp" alt="Mülk Resmi" class="property-image" loading="lazy" width="200" height="150">
        <h3>MÜLKÜMÜ SATMAK İSTİYORUM</h3>
        <p>Mülk bilgilerini girin. Değerlendirip, o bölgedeki profesyonel üyelerimizden en az 20 emlakçıya&nbsp;yönlendirelim</p>
        <!-- Bilgilendirme Simgesi -->
        <div class="info-icon" data-tooltip="Bu form, mülkünüzü satma sürecinizi kolaylaştırmak için tasarlandı. Mülk bilgilerinizi girdikten sonra, hızlı bir değerlendirme yapılacak ve en kısa sürede sizinle iletişime geçilecektir. Doğrulama sonrası çokça telefon alabilirsiniz. Mülkünüzü satması için 20 emlakçı sizi arayabilir. Dilediğiniz emlakçıya teslim edebilirsiniz.
                 Umarım&nbsp;beğenirsiniz!">
            <span>!</span>
        </div>
    </div>
    <!-- Ücretsiz Hizmet Penceresi -->
    <div class="service-popup-2" id="servicePopup" onclick="window.location.href='@Url.Action("YatirimYapmakIstiyorum", "Form")'">
        <span class="label-2">Ücretsiz Hizmet</span>
        <img src="~/images/banabul.webp" alt="Mülk Resmi" class="property-image-2" loading="lazy" width="200" height="150">
        <h3>YATIRIM YAPMAK <br />İSTİYORUM</h3>
        <p>Aradığınız mülkün özelliklerini girin. <br />Size en uygun mülkü bulalım</p>
    </div>
    <!-- ŞevvalDrone Hizmet Penceresi -->
    <div class="sevvaldrone-popup" id="sevvaldrone-popup">
        <span class="label">300₺</span>
        <div class="drone-icon">
            <!-- Güncellenmiş Drone İkonu (PNG) -->
            <img src="https://cdn-icons-png.flaticon.com/128/7504/7504454.png"
                 alt="Drone İkonu"
                 loading="lazy"
                 width="80" height="80"
                 onerror="this.onerror=null;this.src='https://cdn-icons-png.flaticon.com/128/7504/7504454.png';"
                 class="w-full h-full object-contain rounded-full">
        </div>
        <h3>ŞEVVALDRONE</h3>
        <p>Mülkünüzü ŞevvalDrone ile hızlıca videolandırın</p>
    </div>

</div>

<!-- Video Gösterme Modalı -->
<div id="video-modal" class="video-modal">
    <div class="video-modal-content">
        <button class="close-button" id="close-video-modal">&times;</button>
        <iframe id="youtube-video-player" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <p class="order-text">Sipariş Ver</p>
        <a href="#" class="whatsapp-button" id="whatsapp-order-button">
            <i class="fab fa-whatsapp"></i> WhatsApp'tan Mesaj Gönder
        </a>
    </div>
</div>

<script>
    // Sayıyı noktalarla formatlayan fonksiyon
    function formatNumber(number) {
        return number.toLocaleString('tr-TR'); // Türkçe formatı kullanır
    }
    // Toplam ve aktif ziyaretçi sayısını güncelleyen fonksiyon
    async function updateVisitorCounts() {
        try {
            // Aktif ziyaretçi sayısını al
            const activeResponse = await fetch('/api/visitor/active');
            const activeCount = await activeResponse.json();
            // Toplam ziyaretçi sayısını al
            const totalResponse = await fetch('/api/visitor/total');
            const totalCount = await totalResponse.json();
            // Sayıları HTML'de güncelle ve formatla (navbar için)
            document.getElementById('active-visitors-navbar').textContent = formatNumber(activeCount);
            document.getElementById('total-visitors-navbar').textContent = formatNumber(totalCount);
        } catch (error) {
            console.error('Ziyaretçi sayıları güncellenirken hata oluştu:', error);
        }
    }
    // Kullanıcı siteye girdiğinde ziyaretçi kaydını oluştur
    async function recordVisitor() {
        try {
            await fetch('/api/visitor/enter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        } catch (error) {
            console.error('Ziyaretçi kaydı oluşturulurken hata oluştu:', error);
        }
    }
    // Kullanıcı siteyi kapattığında ziyaretçi kaydını sil
    async function exitVisitor(visitorId) {
        try {
            await fetch(`/api/visitor/exit?visitorId=${visitorId}`, {
                method: 'POST'
            });
        } catch (error) {
            console.error('Ziyaretçi çıkış kaydı oluşturulurken hata oluştu:', error);
        }
    }
    // Sayfa yüklendiğinde ziyaretçi kaydını oluştur ve sayıları güncelle
    document.addEventListener('DOMContentLoaded', () => {
        recordVisitor(); // Ziyaretçi kaydını oluştur
        updateVisitorCounts(); // İlk güncellemeyi yap
        // Her 5 saniyede bir güncellemeleri tekrarla
        setInterval(updateVisitorCounts, 5000);
        // Kullanıcı siteyi kapattığında ziyaretçi kaydını sil
        window.addEventListener('beforeunload', () => {
            const visitorId = localStorage.getItem('visitorId'); // Kullanıcıya özel bir ID tutuyorsanız
            if (visitorId) {
                exitVisitor(visitorId);
            }
        });

             // ŞevvalDrone popup'ı ve video modalı için event listener'lar
        const sevvalDronePopup = document.getElementById('sevvaldrone-popup');
        const videoModal = document.getElementById('video-modal');
        const closeVideoModalButton = document.getElementById('close-video-modal');
        const youtubeVideoPlayer = document.getElementById('youtube-video-player');
        const whatsappOrderButton = document.getElementById('whatsapp-order-button');

        const videoUrl = "https://www.youtube.com/embed/4GOC1El49Qk?autoplay=1&loop=1&playlist=4GOC1El49Qk&mute=1";


        sevvalDronePopup.addEventListener('click', () => {
            // Not: videoUrl zaten autoplay parametresini içeriyor, bu yüzden tekrar eklemeye gerek yok.
            youtubeVideoPlayer.src = videoUrl; // Videoyu oynat
            videoModal.style.display = 'flex';
        });

        closeVideoModalButton.addEventListener('click', () => {
            youtubeVideoPlayer.src = ""; // Videoyu durdur
            videoModal.style.display = 'none';
        });

        videoModal.addEventListener('click', (event) => {
            if (event.target === videoModal) {
                youtubeVideoPlayer.src = ""; // Videoyu durdur
                videoModal.style.display = 'none';
            }
        });

        whatsappOrderButton.addEventListener('click', (event) => {
            event.preventDefault();
            const phoneNumber = "905066601624"; // 0506 660 16 24 numarasının ülke kodu ile hali
            const message = encodeURIComponent("ŞevvalDrone hizmeti almak istiyorum");
            let whatsappLink = `https://wa.me/${phoneNumber}?text=${message}`;

            // Mobil cihaz kontrolü
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                // Mobil cihazlar için direkt WhatsApp uygulaması açma denemesi
                // WhatsApp Business için özel bir URL olmasa da, wa.me genellikle doğru uygulamayı açar
                whatsappLink = `whatsapp://send?phone=${phoneNumber}&text=${message}`;
            } else {
                // Bilgisayar için WhatsApp Web
                whatsappLink = `https://web.whatsapp.com/send?phone=${phoneNumber}&text=${message}`;
            }
            window.open(whatsappLink, '_blank');
        });
    });
</script>

<div class="image-container" style="margin-top: 0px;">
</div>

<div class="listings-popup">
    <h2 style="color: #0d6efd">İlanlarımız</h2>

    @await Component.InvokeAsync("AnnouncementCards")

    <!-- Recently Visited Announcements Section -->
    @if (User.Identity.IsAuthenticated)
    {
        @await Component.InvokeAsync("RecentlyVisitedAnnouncements")
        @await Component.InvokeAsync("SuitableAnnouncements")
    }

    @await Component.InvokeAsync("CityAnnouncements", Model.SehirIlanSayilari)

    <div class="advisor-container">
        <h3 class="text-center text-white">Üyelerimiz</h3>
        <div class="advisor-wrapper" id="advisor-scroll-wrapper">
            @foreach (var user in Model.Users)
            {
                // Resim Yolu Düzeltme İşlemi
                // Veritabanındaki dosya yolunu production URL formatına çeviriyoruz.
                string photoPath = user.ProfilePicturePath;
                if (!string.IsNullOrEmpty(photoPath))
                {
                    // Ters slashleri düzelt
                    photoPath = photoPath.Replace("\\", "/");

                    // Eğer zaten tam URL ise dokunma
                    if (!photoPath.StartsWith("http"))
                    {
                        // Eğer yol 'wwwroot' içeriyorsa temizle
                        if (photoPath.Contains("wwwroot/"))
                        {
                            photoPath = photoPath.Substring(photoPath.IndexOf("wwwroot/") + 8);
                        }
                        else if (photoPath.Contains("wwwroot"))
                        {
                            photoPath = photoPath.Substring(photoPath.IndexOf("wwwroot") + 7);
                        }

                        // Başında slash yoksa ekle
                        if (!photoPath.StartsWith("/"))
                        {
                            photoPath = "/" + photoPath;
                        }

                        // Yerel yolu production URL'sine çevir
                        photoPath = "https://www.sevval.com" + photoPath;
                    }
                }
                else
                {
                    // Fotoğraf yoksa varsayılan görsel
                    photoPath = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
                }

                <div class="advisor-card">
                    <div class="advisor-img-wrapper">
                        <!--
                            onerror eventindeki gizleme kodunu kaldırdık.
                            Böylece resim yüklenemese bile (kırık link vb.) kart görünür kalacak.
                            İsterseniz onerror="this.src='/images/default-avatar.png'" gibi bir varsayılan resim ataması yapabilirsiniz.
                        -->
                        <img src="@photoPath" class="advisor-img" alt="Profil Fotoğrafı"
                             width="80" height="80"
                             onerror="this.onerror=null; this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png';">
                    </div>
                    <div class="advisor-info">
                        @{
                            string fullName = user.FirstName + " " + user.LastName;
                            string truncatedName = fullName.Length > 15 ? fullName.Substring(0, 15) + "..." : fullName;
                        }
                        <h5 class="advisor-name">@truncatedName</h5>
                        <p class="advisor-email">@user.UserTypes</p>
                        <a href="@Url.Action("UserIlanlar", "Ilan", new { email = user.Email })" class="advisor-btn">Sayfaya Git</a>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- WhatsApp Logo -->
    <a id="whatsapp-link-8" href="https://wa.me/905070775666?text=Merhaba%2C%20%C5%9Eevval%20Emlak%20Sitesinden%20Size%20Ula%C5%9F%C4%B1yorum" target="_blank" class="whatsapp-float">
        <img src="~/sablon/img/724destek.webp" alt="WhatsApp" class="whatsapp-image" loading="lazy" width="90" height="90">
    </a>

    <div class="comments-section">

        @{
            // NOT: Yorumları rastgele değil, tarihe göre sıralı göstermek daha mantıklı olabilir
            // ama orjinal koddaki random mantığı korundu, sadece controller'dan gelen filtreli liste kullanıldı
            var displayComments = Model.Comments;
        }

        <h3>Son Yorumlar</h3>
        <div class="comments-container">
            @if (displayComments.Any())
            {
                @foreach (var comment in displayComments)
                {
                    <div class="comment-card @(User.Identity.Name == "sftumen41@gmail.com" && !comment.IsApproved ? "comment-unapproved" : "")" id="comment-@comment.Id">
                        <p class="comment-user">
                            <strong>@comment.UserFullName</strong>
                            <span class="comment-date">(@comment.CreatedAt.ToString("dd MMMM yyyy HH:mm", new System.Globalization.CultureInfo("tr-TR")))</span>

                            @if (User.Identity.IsAuthenticated)
                            {
                                @if (User.Identity.Name == "sftumen41@gmail.com" || User.Identity.Name == "exdel.txt@gmail.com")
                                {
                                    <button class="comment-delete-btn" data-comment-id="@comment.Id">&#10005;</button>
                                }

                                @if (User.Identity.Name == "sftumen41@gmail.com" && !comment.IsApproved)
                                {
                                    <button class="comment-approve-btn" data-comment-id="@comment.Id" title="Yorumu Onayla">
                                        <i class="fas fa-check"></i>
                                    </button>
                                }
                            }
                        </p>
                        <p class="comment-content">@Html.Raw(comment.Content)</p>
                    </div>
                }
            }
            else
            {
                <p style="text-align:center; color:#666;">Henüz görüntülenecek yorum yok.</p>
            }
        </div>
        <a href="@Url.Action("TumYorumlar", "Home")" class="show-more-btn" id="show-more-btn">Tüm Yorumlar</a>
        <!-- Yorum ekleme formu aşağı taşındı -->
        @if (User.Identity.IsAuthenticated)
        {
            <form asp-action="AddComment" method="post" class="comment-form">
                <textarea name="content" rows="4" placeholder="Yorumunuzu yazın... (Yorumunuz onaylandıktan sonra yayınlanacaktır)"></textarea>
                <button type="submit">Yorum Yap</button>
            </form>
        }
        else
        {
            <!-- Üye olmayan kullanıcı için isim, soyisim ve yorum alanlarını içeren form -->
            <form asp-action="AddComment" method="post" class="comment-form">
                <input type="text" name="firstName" placeholder="İsim" required />
                <input type="text" name="lastName" placeholder="Soyisim" required />
                <textarea name="content" rows="4" placeholder="Yorumunuzu yazın... (Yorumunuz onaylandıktan sonra yayınlanacaktır)" required></textarea>
                <button type="submit">Yorum Yap</button>
            </form>
        }

    </div>

    <div class="gif-container">
        <a href="https://www.instagram.com/tunalavanta/" target="_blank" rel="noopener noreferrer">
            <img src="~/sablon/img/lavanta.gif" alt="Instagram GIF" class="centered-gif" loading="lazy" width="300" height="300">
        </a>
    </div>

    <!-- İletişim Penceresi -->
    <div class="contact-popup">
        <div class="contact-left">
            <img src="~/images/şevvalemlak.webp" alt="İletişim Resmi" class="contact-image" loading="lazy" width="300" height="200">
        </div>
        <div class="contact-right">
            <h2>Bizimle İletişime Geçin</h2>
            <p>Sizin için en iyi yatırıma yardımcı olalım! Satın almak, kiralamak veya satmak istiyorsanız, deneyimli danışmanlarımızla iletişime geçerek hemen adım atın.</p>
            <a id="whatsapp-link-7" class="whatsapp-button" target="_blank" href="https://wa.me/905070775666?text=Merhaba%2C%20%C5%9Eevval%20Emlak%20Sitesinden%20Size%20Ula%C5%9F%C4%B1yorum">
                <img src="~/sablon/img/WhatsApp_icon.webp" alt="WhatsApp İkonu" class="whatsapp-icon" loading="lazy" width="24" height="24">
                7/24 WhatsApp Destek
            </a>

        </div>
    </div>
</div>

@section Scripts {
    <!-- Bootstrap 5 JS Bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        // Günün İlanı Modal Kontrolü
        document.addEventListener('DOMContentLoaded', function() {
            var dailyOfferModalElement = document.getElementById('dailyOfferModal');
            if (dailyOfferModalElement) {
                // Bootstrap modal instance oluştur
                var dailyOfferModal = new bootstrap.Modal(dailyOfferModalElement);

                // Sayfa yüklendiğinde aç
                dailyOfferModal.show();

                // Floating icon'a basınca aç
                var floatingIcon = document.getElementById('floating-offer-icon');
                if (floatingIcon) {
                    floatingIcon.addEventListener('click', function(e) {
                        e.preventDefault();
                        dailyOfferModal.show();
                    });
                }

                // Modal açıldığında Swiper'ı başlat
                dailyOfferModalElement.addEventListener('shown.bs.modal', function () {
                    var swiper = new Swiper(".dailyOfferSwiper", {
                        navigation: {
                            nextEl: ".swiper-button-next",
                            prevEl: ".swiper-button-prev",
                        },
                        loop: true,
                        autoplay: {
                            delay: 3500,
                            disableOnInteraction: false,
                        },
                    });
                });
            }
        });

        // Telefon Formatlama ve Arama
        function formatPhoneNumberv1(phoneNumber) {
            const digitsOnly = phoneNumber.replace(/\D/g, '');
            if (digitsOnly.startsWith('0') && digitsOnly.length === 11) {
                return `+90${digitsOnly.substring(1)}`;
            }
            if (digitsOnly.startsWith('90') && digitsOnly.length === 12) {
                return `+${digitsOnly}`;
            }
            return phoneNumber.startsWith('+') ? phoneNumber : `+${phoneNumber}`;
        }

        function sendMessageToWhatsapp() {
            var phoneNumber = '@ViewBag?.GununIlan?.PhoneNumber';
            phoneNumber = formatPhoneNumberv1(phoneNumber);
            var message = encodeURIComponent("Merhaba Şevval Emlak Sitesinden Size Ulaşıyorum İlan Hakkında Bilgi Almak İstiyorum");
            if (window.innerWidth <= 800) {
                window.location.href = `https://wa.me/${phoneNumber}?text=${message}`;
            } else {
                window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
            }
        }

        function makeCall() {
            var phoneNumber = '@ViewBag?.GununIlan?.PhoneNumber';
            if (phoneNumber.charAt(0) !== '0') { phoneNumber = '0' + phoneNumber; }
            window.location.href = `tel:${phoneNumber}`;
        }
    </script>

    <script>
        // İlan sayısı daktilo efekti
        const input = document.getElementById("siteSearchInput");
        let ilanSayisi = @Model.TotalIlanlar;
        let formattedIlanSayisi = ilanSayisi.toLocaleString('tr-TR');
        let messages = [
            "Aradığınız şeyi yazın...",
            `"${formattedIlanSayisi}" ilan arasında aramanızı yapın...`,
            "Satılık ilanlar arasında aramanızı yapın...",
            "Kiralık ilanlar arasında aramanızı yapın...",
            "Konut ilanları arasında aramanızı yapın...",
            "Arsa ilanları arasında aramanızı yapın...",
            "Bahçe ilanları arasında aramanızı yapın...",
            "Tarla ilanları arasında aramanızı yapın...",
            "İş Yeri ilanları arasında aramanızı yapın...",
            "Turistik Tesis ilanları arasında aramanızı yapın..."
        ];

        let currentMessageIndex = 0;
        let charIndex = 0;

        function typewriterEffect() {
            if (charIndex < messages[currentMessageIndex].length) {
                input.setAttribute("placeholder", messages[currentMessageIndex].substring(0, charIndex + 1));
                charIndex++;
                setTimeout(typewriterEffect, 50);
            } else {
                setTimeout(() => {
                    currentMessageIndex = (currentMessageIndex + 1) % messages.length;
                    charIndex = 0;
                    typewriterEffect();
                }, 3000);
            }
        }
        typewriterEffect();

        // Diğer scriptler (Visitor, LazyLoad vb.)
        function formatNumber(number) { return number.toLocaleString('tr-TR'); }
        async function updateVisitorCounts() {
            try {
                const activeResponse = await fetch('/api/visitor/active');
                const activeCount = await activeResponse.json();
                const totalResponse = await fetch('/api/visitor/total');
                const totalCount = await totalResponse.json();
                const activeEl = document.getElementById('active-visitors-navbar');
                if(activeEl) activeEl.textContent = formatNumber(activeCount);
                const totalEl = document.getElementById('total-visitors-navbar');
                if(totalEl) totalEl.textContent = formatNumber(totalCount);
            } catch (error) { }
        }
        async function recordVisitor() { try { await fetch('/api/visitor/enter', { method: 'POST', headers: { 'Content-Type': 'application/json' } }); } catch (error) { } }
        async function exitVisitor(visitorId) { try { await fetch(`/api/visitor/exit?visitorId=${visitorId}`, { method: 'POST' }); } catch (error) { } }

        document.addEventListener('DOMContentLoaded', () => {
            recordVisitor();
            updateVisitorCounts();
            setInterval(updateVisitorCounts, 5000);
            window.addEventListener('beforeunload', () => { const visitorId = localStorage.getItem('visitorId'); if (visitorId) exitVisitor(visitorId); });

            const sevvalDronePopup = document.getElementById('sevvaldrone-popup');
            const videoModal = document.getElementById('video-modal');
            const closeVideoModalButton = document.getElementById('close-video-modal');
            const youtubeVideoPlayer = document.getElementById('youtube-video-player');
            const videoUrl = "https://www.youtube.com/embed/4GOC1El49Qk?autoplay=1&loop=1&playlist=4GOC1El49Qk&mute=1";

            if(sevvalDronePopup) {
                sevvalDronePopup.addEventListener('click', () => { youtubeVideoPlayer.src = videoUrl; videoModal.style.display = 'flex'; });
            }
            if(closeVideoModalButton) {
                closeVideoModalButton.addEventListener('click', () => { youtubeVideoPlayer.src = ""; videoModal.style.display = 'none'; });
            }
            if(videoModal) {
                videoModal.addEventListener('click', (event) => { if (event.target === videoModal) { youtubeVideoPlayer.src = ""; videoModal.style.display = 'none'; } });
            }
        });

        // Yorumlar JS
        $(document).ready(function () {
            $("#show-more-btn").click(function () {
                $(".hidden-comment").toggle();
                var btnText = $(this).text() === "Tümünü Göster" ? "Daha Az Göster" : "Tümünü Göster";
                $(this).text(btnText);
            });

            // Yorum Silme
            $(".comment-delete-btn").click(function () {
                var commentId = $(this).data("comment-id");
                if(confirm("Yorumu silmek istediğinize emin misiniz?")) {
                    $.ajax({
                        url: '/Home/DeleteComment', type: 'POST', data: { commentId: commentId },
                        success: function () { $("#comment-" + commentId).remove(); },
                        error: function () { alert("Hata oluştu."); }
                    });
                }
            });

            // YENİ: Yorum Onaylama
            $(".comment-approve-btn").click(function () {
                var commentId = $(this).data("comment-id");
                var btn = $(this);
                $.ajax({
                    url: '/Home/ApproveComment', type: 'POST', data: { commentId: commentId },
                    success: function () {
                        // Başarılı olursa butonu kaldır ve sarı kenarlığı temizle
                        btn.remove();
                        $("#comment-" + commentId).removeClass("comment-unapproved");
                        alert("Yorum onaylandı.");
                    },
                    error: function () { alert("Hata oluştu."); }
                });
            });
        });

        // Options ve Filtreleme JS
        function showOption(optionId) {
            const selectedDetail = document.getElementById(optionId);
            if (selectedDetail.classList.contains('active')) {
                selectedDetail.classList.remove('active');
                const anyActive = document.querySelector('.option-details.active') !== null;
                if (!anyActive) document.body.classList.remove('filter-open');
            } else {
                const allDetails = document.querySelectorAll('.option-details');
                allDetails.forEach(detail => detail.classList.remove('active'));
                selectedDetail.classList.add('active');
                document.body.classList.add('filter-open');
            }
        }
        document.addEventListener('click', function(event) {
            const customOptionsContainer = document.querySelector('.custom-options-container');
            if (customOptionsContainer && !customOptionsContainer.contains(event.target)) {
                const allDetails = document.querySelectorAll('.option-details');
                allDetails.forEach(detail => detail.classList.remove('active'));
                document.body.classList.remove('filter-open');
            }
        });

        function googleTranslateElementInit() { new google.translate.TranslateElement({ pageLanguage: 'tr' }, 'google_translate_element'); }

        // Searchable Select Class
        class SearchableSelect {
            constructor(originalSelect, options = {}) {
                this.originalSelect = originalSelect;
                this.placeholder = options.placeholder || originalSelect.options[0]?.text || 'Seçiniz';
                this.searchPlaceholder = options.searchPlaceholder || 'Ara...';
                this.onSelect = options.onSelect || null;
                this.extraClass = options.extraClass || '';
                this.items = [];
                this.filteredItems = [];
                this.highlightedIndex = -1;
                this.isOpen = false;
                this.init();
            }

            init() {
                this.createWrapper();
                this.bindEvents();
                this.loadItems();
            }

            createWrapper() {
                this.wrapper = document.createElement('div');
                this.wrapper.className = 'searchable-select-wrapper' + (this.extraClass ? ' ' + this.extraClass : '');

                this.display = document.createElement('div');
                this.display.className = 'searchable-select-display';
                this.display.textContent = this.placeholder;
                this.display.tabIndex = 0;

                this.dropdown = document.createElement('div');
                this.dropdown.className = 'searchable-select-dropdown';

                this.searchInput = document.createElement('input');
                this.searchInput.type = 'text';
                this.searchInput.className = 'searchable-select-search';
                this.searchInput.placeholder = this.searchPlaceholder;

                this.optionsContainer = document.createElement('div');
                this.optionsContainer.className = 'searchable-select-options';

                this.dropdown.appendChild(this.searchInput);
                this.dropdown.appendChild(this.optionsContainer);
                this.wrapper.appendChild(this.display);
                this.wrapper.appendChild(this.dropdown);

                this.originalSelect.style.display = 'none';
                this.originalSelect.parentNode.insertBefore(this.wrapper, this.originalSelect.nextSibling);
            }

            loadItems() {
                this.items = [];
                Array.from(this.originalSelect.options).forEach((option, index) => {
                    if (index === 0 && option.value === '') return;
                    this.items.push({ value: option.value, text: option.text });
                });
                this.filteredItems = [...this.items];
                this.renderOptions();
            }

            renderOptions() {
                this.optionsContainer.innerHTML = '';
                if (this.filteredItems.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.className = 'searchable-select-option no-results';
                    noResult.textContent = 'Sonuç bulunamadı';
                    this.optionsContainer.appendChild(noResult);
                    return;
                }
                this.filteredItems.forEach((item, index) => {
                    const option = document.createElement('div');
                    option.className = 'searchable-select-option';
                    option.textContent = item.text;
                    option.dataset.value = item.value;
                    if (this.originalSelect.value === item.value) {
                        option.classList.add('selected');
                    }
                    if (index === this.highlightedIndex) {
                        option.classList.add('highlighted');
                    }
                    option.addEventListener('click', () => this.selectItem(item));
                    this.optionsContainer.appendChild(option);
                });
            }

            selectItem(item) {
                this.originalSelect.value = item.value;
                this.display.textContent = item.text;
                this.close();
                this.originalSelect.dispatchEvent(new Event('change'));
                if (this.onSelect) this.onSelect(item);
            }

            open() {
                if (this.isOpen) return;
                this.isOpen = true;
                this.wrapper.classList.add('open');
                this.searchInput.value = '';
                this.filteredItems = [...this.items];
                this.highlightedIndex = -1;
                this.renderOptions();
                setTimeout(() => this.searchInput.focus(), 10);
            }

            close() {
                if (!this.isOpen) return;
                this.isOpen = false;
                this.wrapper.classList.remove('open');
            }

            toggle() {
                this.isOpen ? this.close() : this.open();
            }

            filter(query) {
                const normalizedQuery = this.normalizeText(query);
                this.filteredItems = this.items.filter(item =>
                    this.normalizeText(item.text).includes(normalizedQuery)
                );
                this.highlightedIndex = this.filteredItems.length > 0 ? 0 : -1;
                this.renderOptions();
            }

            normalizeText(text) {
                // Önce Türkçe büyük harfleri dönüştür, sonra toLowerCase
                return text
                    .replace(/İ/g, 'i')
                    .replace(/I/g, 'i')
                    .replace(/Ğ/g, 'g')
                    .replace(/Ü/g, 'u')
                    .replace(/Ş/g, 's')
                    .replace(/Ö/g, 'o')
                    .replace(/Ç/g, 'c')
                    .toLowerCase()
                    .replace(/ı/g, 'i')
                    .replace(/ğ/g, 'g')
                    .replace(/ü/g, 'u')
                    .replace(/ş/g, 's')
                    .replace(/ö/g, 'o')
                    .replace(/ç/g, 'c');
            }

            highlightNext() {
                if (this.filteredItems.length === 0) return;
                this.highlightedIndex = (this.highlightedIndex + 1) % this.filteredItems.length;
                this.renderOptions();
                this.scrollToHighlighted();
            }

            highlightPrev() {
                if (this.filteredItems.length === 0) return;
                this.highlightedIndex = this.highlightedIndex <= 0 ? this.filteredItems.length - 1 : this.highlightedIndex - 1;
                this.renderOptions();
                this.scrollToHighlighted();
            }

            scrollToHighlighted() {
                const highlighted = this.optionsContainer.querySelector('.highlighted');
                if (highlighted) {
                    highlighted.scrollIntoView({ block: 'nearest' });
                }
            }

            selectHighlighted() {
                if (this.highlightedIndex >= 0 && this.filteredItems[this.highlightedIndex]) {
                    this.selectItem(this.filteredItems[this.highlightedIndex]);
                }
            }

            bindEvents() {
                this.display.addEventListener('click', () => this.toggle());
                this.display.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.toggle();
                    }
                });

                this.searchInput.addEventListener('input', (e) => {
                    this.filter(e.target.value);
                });

                this.searchInput.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            this.highlightNext();
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            this.highlightPrev();
                            break;
                        case 'Enter':
                            e.preventDefault();
                            this.selectHighlighted();
                            break;
                        case 'Escape':
                            this.close();
                            break;
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!this.wrapper.contains(e.target)) {
                        this.close();
                    }
                });
            }

            refresh() {
                this.loadItems();
                const selectedOption = this.originalSelect.options[this.originalSelect.selectedIndex];
                this.display.textContent = selectedOption?.value ? selectedOption.text : this.placeholder;
            }

            reset() {
                this.originalSelect.selectedIndex = 0;
                this.display.textContent = this.placeholder;
                this.loadItems();
            }
        }

        // Il/Ilce Searchable Select Initialization
        $(document).ready(function () {
            var citySelectors = ['sehir', 'sehirArsa', 'sehirBahce', 'sehirTarla', 'sehirIsYeri', 'sehirTuristik'];
            var searchableSelects = {};

            $.ajax({
                url: '/api/provinces', method: 'GET', dataType: 'json',
                success: function(provinces) {
                    citySelectors.forEach(function(id) {
                        var $select = $(`#${id}`);
                        if($select.length) {
                            provinces.forEach(function(province) { $select.append(new Option(province, province)); });

                            // Create searchable select for Il
                            searchableSelects[id] = new SearchableSelect($select[0], {
                                placeholder: 'İl Seçiniz',
                                searchPlaceholder: 'İl ara... (örn: Zon, Ank, İst)',
                                extraClass: 'location-dropdown'
                            });

                            // Create searchable select for Ilce
                            var semtId = id.replace('sehir', 'semt');
                            var $semtSelect = $(`#${semtId}`);
                            if($semtSelect.length) {
                                searchableSelects[semtId] = new SearchableSelect($semtSelect[0], {
                                    placeholder: 'İlçe Seçiniz',
                                    searchPlaceholder: 'İlçe ara...',
                                    extraClass: 'location-dropdown'
                                });
                            }
                        }
                    });
                }
            });

            citySelectors.forEach(function(id) {
                $(`#${id}`).change(function() {
                    var selectedProvince = $(this).val();
                    var relatedSemt = $(this).attr('id').replace('sehir', 'semt');
                    var relatedMahalle = $(this).attr('id').replace('sehir', 'mahalle');
                    $(`#${relatedSemt}`).empty().append('<option value="">İlçe Seçiniz</option>');
                    $(`#${relatedMahalle}`).empty().append('<option value="">Mahalle/Köy Seçiniz</option>');

                    // Reset searchable select for ilce
                    if (searchableSelects[relatedSemt]) {
                        searchableSelects[relatedSemt].reset();
                    }

                    if (selectedProvince) {
                        $.ajax({
                            url: '/api/districts/' + encodeURIComponent(selectedProvince), method: 'GET', dataType: 'json',
                            success: function(districts) {
                                districts.forEach(function(district) { $(`#${relatedSemt}`).append(new Option(district, district)); });
                                // Refresh searchable select for ilce
                                if (searchableSelects[relatedSemt]) {
                                    searchableSelects[relatedSemt].refresh();
                                }
                            }
                        });
                    }
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Yatay scroll fonksiyonu
            function setupHorizontalScroll(element) {
                if (!element) return;
                let isScrolling = false;
                element.addEventListener('wheel', function(e) {
                    e.preventDefault();
                    if (!isScrolling) {
                        isScrolling = true;
                        if (e.deltaY > 0) {
                            element.scrollBy({ left: 500, behavior: 'smooth' });
                        } else {
                            element.scrollBy({ left: -500, behavior: 'smooth' });
                        }
                        setTimeout(() => isScrolling = false, 100);
                    }
                }, { passive: false });
            }

            // Advisor wrapper (Üyelerimiz) için mouse wheel scroll
            setupHorizontalScroll(document.getElementById('advisor-scroll-wrapper'));

            // Şehirler wrapper için mouse wheel scroll
            setupHorizontalScroll(document.getElementById('sehirler-scroll-wrapper'));
        });

        document.addEventListener('DOMContentLoaded', function() {
            const lazyImages = document.querySelectorAll('img[loading="lazy"]');
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) { img.src = img.dataset.src; img.removeAttribute('data-src'); observer.unobserve(img); }
                        }
                    });
                });
                lazyImages.forEach(img => { imageObserver.observe(img); });
            }
            convertImagesToWebP();
        });

        function convertImagesToWebP() {
            const allImages = document.querySelectorAll('img');
            allImages.forEach(img => {
                // Hariç tutulacak container'lar
                if (img.closest('.service-popup') || img.closest('.service-popup-2') || img.closest('.sevvaldrone-popup') || img.closest('.swiper-slide')) return;
                // Profil resimlerini (üyelerimiz bölümü) ve harici URL'leri hariç tut
                if (img.closest('.advisor-img-wrapper') || img.closest('.advisor-card')) return;
                if (img.src && img.src.includes('sevval.com')) return; // Production URL'lerini dönüştürme
                if (img.src && img.src.includes('flaticon.com')) return; // CDN resimlerini dönüştürme
                if (img.src && !img.src.includes('.webp')) { img.src = img.src.replace(/\.(jpe?g|png)$/i, '.webp'); }
            });
        }

        // Şehre göre arama - Şehre Göre İlanlar kartları için
        function submitHizliAraSehir(sehir) {
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = '/Ilan/HizliAra';

            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'detayliAramaRequestDTO.Il';
            input.value = sehir;
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
        }

        // Kategoriye göre arama - İlanlarımız kartları için
        function submitHizliAraKategori(kategori) {
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = '/Ilan/HizliAra';

            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'detayliAramaRequestDTO.Kategori';
            input.value = kategori;
            form.appendChild(input);

            document.body.appendChild(form);
            form.submit();
        }
    </script>
}