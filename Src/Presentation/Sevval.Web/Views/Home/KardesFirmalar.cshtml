@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@model sevvalemlak.csproj.Dto.Company.CompanySearchDto

<link rel="stylesheet" href="~/css/kardesfirmalar.css">
<link rel="stylesheet" href="~/css/anasayfa.css">
<link rel="icon" type="image/png" href="~/images/favlogo.webp">

<style>
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh; /* Sayfa yüksekliğini %100 yapar */
        margin: 0; /* Varsayılan margin'i kaldırır */
        background-image: url('~/images/arka-plan-resmi.webp');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    .centered-text {
        text-align: center; /* Metni ortalar */
        margin-top: 50px; /* Üstten boşluk */
        flex-grow: 1; /* Ana içeriği uzatır */
    }

    .large-title {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: -62px;
    }

    .small-text {
        font-size: 1.2em; /* Küçük yazı boyutu */
        color: #555; /* Yazı rengi */
    }

    .footer {
        background-color: #333; /* Footer arka plan rengi */
        color: white; /* Footer yazı rengi */
        padding: 20px; /* İç boşluk */
        text-align: center; /* Metni ortalar */
    }
</style>
<style>
    /* ===== Unified layout + alignment reset for Firms header ===== */
    :root { --page-max: 100%; --ctl-h: 44px; --radius: 10px; --ring:#e9eef7; }

    .centered-text { max-width: var(--page-max); margin: 18px auto 8px auto; padding: 0 12px; }
    .large-title { margin: 0; letter-spacing: .6px; }

    .firms-header-row { max-width: var(--page-max); margin: 8px auto 22px auto; padding: 0 12px 0 0; }

    .filter-controls { background:#fff; border:1px solid var(--ring); border-radius: 14px; box-shadow: 0 8px 18px rgba(20,40,90,.06); padding: 14px; }
    .filter-row { margin: 0; }
    .filter-group { min-width: 0; }
    .filter-select { height: var(--ctl-h); border-radius: var(--radius); border:1px solid var(--ring); }
    .apply-btn, .clear-btn { height: var(--ctl-h); border-radius: var(--radius); }

    .search-row-wrap { max-width: 100%; margin-left: 36px; padding: 0; background:#fff; border:1px solid #cfe1ff; border-radius: 12px; box-shadow: 0 8px 22px rgba(11,42,87,.12); }
    .search-row-wrap .search-input { margin: 0; height: var(--ctl-h); max-width: 100%; border:0; border-right:0; border-radius: 8px 0 0 8px !important; box-shadow: none; }
    .search-row-wrap .search-input::placeholder { color:#0b2a57; opacity:.7; }
    .search-row-wrap button[type="submit"] { height: var(--ctl-h) !important; border-radius: 8px !important; }

    @@media (max-width: 992px){
        .centered-text { margin: 12px auto 6px auto; }
        .large-title { font-size: 1.8em; }
        .firms-header-row { grid-template-columns: 1fr; gap: 12px; }
        .filter-controls { padding: 12px; }
        .search-row-wrap { max-width: none; }
    }
</style>
<style>
    /* Header row: filters | title | search */
    .firms-header-row {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        gap: 20px;
        margin: 10px 0 20px 0;
    }
    .filters-col { min-width: 0; }
    .title-col { display:flex; justify-content:center; align-items:center; }
    .search-col { display: flex; justify-content: center; align-items: center; }
    .search-row-wrap { display: flex; gap: 10px; justify-content: center; align-items: center; width: 100%; max-width: 100%; }

    @@media (max-width: 992px) {
        .firms-header-row { grid-template-columns: 1fr; }
        .search-col { justify-content: stretch; }
        .search-row-wrap { max-width: none; }
    }
    /* ==== Modern override for Firms grid and cards (non-breaking) ==== */
    :root {
        --firm-bg: #ffffff;
        --firm-text: #1f2d3d;
        --firm-muted: #6b7a90;
        --brand: #0d6efd;
        --brand-2: #2196f3;
        --ring: #e6efff;
        --shadow: 0 8px 24px rgba(20, 40, 90, 0.12);
        --shadow-hover: 0 14px 36px rgba(20, 40, 90, 0.16);
        --radius: 16px;
    }

    .user-list { margin-top: 24px; }

    .user-grid {
        list-style: none; /* semantic list reset */
        padding-left: 0;  /* remove default bullets indentation */
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 26px;
        margin-top: 12px;
        padding: 0 8px;
    }

    .user-card {
        position: relative;
        background: #ffffff;
        color: var(--firm-text);
        border: 1px solid var(--ring);
        border-radius: 20px;
        box-shadow: var(--shadow);
        padding: 22px 20px 18px 20px;
        transition: transform .28s ease, box-shadow .28s ease, border-color .28s ease;
        isolation: isolate;
        overflow: hidden;
    }

    .user-card::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 20px;
        padding: 1px;
        background: linear-gradient(135deg, rgba(13,110,253,.35), rgba(33,150,243,.25));
        -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
        -webkit-mask-composite: xor; mask-composite: exclude;
        opacity: 0;
        transition: opacity .28s ease;
        pointer-events: none;
    }

    .user-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-hover);
        border-color: rgba(13,110,253,.35);
    }
    .user-card:hover::after { opacity: 1; }

    .badge-year {
        position: absolute;
        top: 10px;
        left: 10px;
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        color: #fff;
        padding: 6px 10px;
        font-size: 12px;
        font-weight: 700;
        border-radius: 999px;
        box-shadow: 0 6px 14px rgba(13,110,253,.25);
        z-index: 1;
    }

    .user-profile-picture {
        width: 76px;
        height: 76px;
        border-radius: 50%;
        object-fit: contain;
        background: #fff;
        border: 2px solid #e8f0ff;
        box-shadow: 0 0 0 4px #fff, 0 0 0 6px rgba(13,110,253,.18);
        margin-bottom: 12px;
        transition: box-shadow .28s ease, transform .28s ease;
    }
    .user-card:hover .user-profile-picture { box-shadow: 0 0 0 4px #fff, 0 0 0 8px rgba(13,110,253,.28); transform: translateY(-1px); }

    /* Image placeholder to avoid layout shift */
    .img-box { width: 80px; height: 80px; border-radius: 50%; position: relative; display: inline-block; margin-bottom: 12px; }
    .img-box.loading::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background: linear-gradient(90deg, #f3f6ff 25%, #e9efff 50%, #f3f6ff 75%);
        background-size: 200% 100%;
        animation: shine 1.1s linear infinite;
        box-shadow: 0 0 0 4px #fff, 0 0 0 6px rgba(13,110,253,.12);
    }
    @@keyframes shine { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

    .user-name {
        font-size: 17px;
        font-weight: 800;
        color: var(--firm-text);
        letter-spacing: .2px;
        margin: 4px 0 2px 0;
        text-transform: uppercase;
    }

    .user-name a { color: inherit; text-decoration: none; }
    .user-name a:hover { text-decoration: underline; text-underline-offset: 3px; }

    .user-location {
        margin: 2px 0 8px 0;
        font-size: 13px;
        color: var(--firm-muted);
    }

    .announcement-minimal {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 999px;
        background: #eef6ff;
        border: 1px solid #cfe5ff;
        color: var(--brand);
        font-weight: 700;
        font-size: 13px;
        transition: background .2s ease, color .2s ease, transform .2s ease, box-shadow .2s ease;
        box-shadow: 0 2px 6px rgba(13,110,253,.12);
    }

    .announcement-minimal:hover {
        background: var(--brand);
        color: #fff;
        transform: translateY(-2px);
    }

    .user-registration-date {
        margin-top: 10px;
        font-size: 12px;
        color: var(--firm-muted);
        line-height: 1.5;
    }

    /* Header title spacing */
    .large-title { letter-spacing: .6px; color: #0b2a57; }

    /* Responsive refinements */
    @@media (max-width: 768px) {
        .user-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 18px; }
        .user-card { padding: 16px; }
        .user-name { font-size: 16px; }
    }
</style>
<style>
    .post-ad-container {
        position: relative;
        display: inline-block;
    }

    .free-tag {
        position: absolute;
        top: -10px;
        left: -10px; /* Daha sağa kaydırmak için artırabilirsiniz */
        background-color: #007bff; /* Mavi arka plan */
        color: white; /* Beyaz metin rengi */
        font-size: 10px;
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 4px;
        transform: rotate(-10deg); /* Hafif eğik bir görünüm */
        z-index: 1;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* Hafif gölge */
    }

    .post-ad {
        display: inline-block;
        background-color: #ffffff; /* Beyaz arka plan */
        color: #007bff; /* Mavi yazı rengi */
        padding: 10px 15px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        border: 1px solid #007bff; /* Mavi çerçeve */
        transition: 0.3s ease;
    }

        .post-ad:hover {
            background-color: #007bff; /* Hoverda mavi arka plan */
            color: white; /* Hoverda beyaz metin */
        }

    .coming-soon-tag {
        position: absolute;
        top: 20px;
        left: 55px; /* Etiketi daha sağa kaydırmak için artırabilirsiniz */
        background-color: #007bff; /* Mavi arka plan */
        color: white; /* Beyaz metin rengi */
        font-size: 10px;
        font-weight: bold;
        padding: 3px 8px;
        border-radius: 4px;
        transform: none; /* Düz bir görünüm için çapraz rotayı kaldırdık */
        z-index: 1;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* Hafif gölge */
    }
</style>
<style>
    /* Pop-up penceresi stili */
    .pencere {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1100;
    }

    /* Pop-up içeriği stili */
    .pencere-icerik {
        background: linear-gradient(90deg, #1e88e5, #2196f3); /* Mavi tonları */
        width: 460px;
        height: 490px;
        display: flex;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        animation: gorunmeEfekti 0.3s ease;
        position: relative;
        padding: 20px;
        box-sizing: border-box;
        margin: auto;
    }

    /* Sol ve sağ bölümler */
    .sol-bolum, .sag-bolum {
        flex: 1;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    /* Sağ bölümdeki ayırıcı */
    .sag-bolum {
        border-left: 2px solid #fff;
    }

    /* Başlık stilleri */
    h2 {
        margin-bottom: 20px;
        font-size: 28px;
        color: #fff;
        font-weight: bold;
    }

    /* Bağlantı buton stilleri */
    .baglanti {
        margin: 15px 0;
        padding: 15px 25px;
        background: #fff;
        color: #1e88e5;
        text-decoration: none;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        font-size: 18px;
        width: 80%;
    }

        .baglanti:hover {
            background: #f1f1f1;
            transform: translateY(-2px);
        }

        .baglanti:focus {
            outline: none;
        }

    /* Kapat butonu */
    .kapat-buton {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 30px;
        color: #fff;
        background: none;
        border: 2px solid #fff;
        text-align: center;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .kapat-buton:hover {
            color: #d32f2f;
            border-color: #d32f2f;
        }
</style>
<style>
    .user-card {
        position: relative; /* Rozeti konumlandırmak için gerekli */
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .badge-year {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #007bff; /* Mavi renk */
        color: #fff; /* Beyaz yazı */
        padding: 5px 10px;
        font-size: 12px;
        font-weight: bold;
        border-radius: 12px; /* Yuvarlak köşeler */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

</style>
<style>
    .announcement-minimal {
        display: inline-block;
        padding: 6px 12px;
        background-color: transparent; /* Şeffaf arka plan */
        color: #007bff; /* Mavi renk */
        font-size: 14px;
        font-weight: 500;
        border-radius: 20px;
        border: 1px solid #007bff; /* İnce mavi kenar çizgisi */
        transition: color 0.3s ease, transform 0.3s ease; /* Geçiş efektleri */
        margin-top: 10px;
    }

        .announcement-minimal:hover {
            color: white; /* Hover'da beyaz yazı */
            background-color: #007bff; /* Hover'da mavi arka plan */
            transform: scale(1.05); /* Hover'da hafif büyüme */
        }



    .user-card {
        margin-bottom: 10px;
        /* Diğer stil ayarları */
    }
</style>
<style>

    .user-list {
        margin-top: 0;
        text-align: center;
    }

    h2 {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #333;
    }

    .user-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Flexible grid */
        gap: 20px;
        margin-top: 1%;
    }

    .user-card {
        background-color: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        cursor: pointer;
    }

        .user-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.2);
        }

    .user-info {
        font-size: 16px;
    }

    .user-name {
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }

    .user-company {
        font-size: 14px;
        color: #555;
        margin-top: 5px; /* Şirket adı ile isim arasındaki mesafe */
    }

    .user-profile-picture {
        width: 80px; /* Fotoğrafın boyutu */
        height: 80px; /* Fotoğrafın boyutu */
        border-radius: 50%; /* Yuvarlak yapmak için */
        object-fit: contain; /* Fotoğrafın tamamını kesmeden sığdırır */
        border: 1px solid blue; /* Mavi çerçeve */
        background-color: white; /* Fotoğrafın dışındaki boş alan siyah olur */
        margin-bottom: 10px; /* İsim ile fotoğraf arasında boşluk */
    }

    /* Arama Çubuğu Stili */
    .search-input {
        width: 60%; /* Genişlik, ihtiyacınıza göre artırılabilir */
        max-width: 600px; /* Maksimum genişlik */
        margin: 20px auto; /* Ortalamak için auto margin ve üstten biraz boşluk */
        padding: 10px; /* İç boşluk */
        font-size: 16px; /* Yazı boyutu */
        border: 2px solid #ccc; /* Çerçeve */
        border-radius: 6px 0px 0px 6px !important;
        /* Kenarları yuvarlatma */
        box-sizing: border-box; /* Padding ve border genişliği dahil et */
        display: inline-block; /* inline-block, daha düzgün bir şekilde ortalanmasına yardımcı olur */
    }

        /* Arama çubuğunun placeholder stilini ayarlamak */
        .search-input::placeholder {
            color: #aaa; /* Placeholder yazısı rengi */
            font-style: italic; /* Placeholder yazısı italik yapıldı */
        }

    .pagination-controls {
        display: flex;
        justify-content: center;
        margin-top: 10px; /* Daha az yer kaplaması için azaltıldı */
        gap: 2px; /* Butonlar arasındaki boşluk küçültüldü */
    }

    .pagination-btn {
        margin: 0;
        padding: 4px 7px;
        font-size: 16px;
        border: 1px solid #007bff;
        background-color: #fff;
        color: #007bff;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
        text-decoration: none;
        margin-bottom: 18px;
    }

        .pagination-btn:hover {
            background-color: #007bff;
            color: #fff;
        }

        .pagination-btn.active {
            background-color: #007bff;
            color: #fff;
        }

        .pagination-btn:disabled {
            background-color: #ddd;
            color: #aaa;
            cursor: not-allowed;
        }

    /* Filter Controls Styling */
    .filter-controls {
        background-color: transparent;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: none;
    border: none;
    }

    .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        justify-content: center;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        min-width: 150px;
        height: 91px;
    }

        .filter-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
        }

    .filter-select {
        padding: 8px 12px !important;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        background-color: white;
        transition: border-color 0.3s ease;
        min-width: 150px;

    }

        .filter-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

    .filter-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        transition: all 0.3s ease;
        margin: 0 5px;
    }

    .apply-btn {
        background-color: #007bff;
        color: white;
        height: 42px;
        margin-bottom: 12px;
    }

        .apply-btn:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

    .clear-btn {
        background-color: #6c757d;
        color: white;
    }

        .clear-btn:hover {
            background-color: #545b62;
            transform: translateY(-1px);
            text-decoration: none;
            color: white;
        }

    /* Tap/click feedback for links and buttons */
    .press-feedback { transition: transform .12s ease, opacity .12s ease; }
    .press-feedback.pressed { transform: scale(0.97); opacity: .75; }
    a.press-feedback:active, button.press-feedback:active { transform: scale(0.97); opacity: .8; }

    /* Goal 3: Touch active feedback for site logo */
    @@media (pointer: coarse) {
        .navbar-brand, .site-logo, .brand-logo, .logo,
        .navbar-brand img, .site-logo img, .brand-logo img, .logo img {
            transition: transform .12s ease, filter .12s ease;
        }
        .navbar-brand:active, .site-logo:active, .brand-logo:active, .logo:active,
        .navbar-brand img:active, .site-logo img:active, .brand-logo img:active, .logo img:active {
            transform: scale(0.96);
            filter: brightness(0.9);
        }
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .filter-row {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-group {
            min-width: auto;
            width: 100%;
        }

        .filter-select {
            min-width: auto;
            width: 100%;
        }
    }

    /* Mobile Responsive Design */
    @@media (max-width: 768px) {
        /* Title adjustments */
        .large-title {
            font-size: 1.8em;
            margin-bottom: -30px;
        }

        .centered-text {
            margin-top: 20px;
        }
        /* Search input mobile optimization */
        .search-input {
            width: 100%;
            max-width: none;
            margin: 10px 0;
            font-size: 16px; /* Prevents zoom on iOS */
            border-radius: 6px;
        }
        /* Search button mobile styling */
        div[style*="display: flex"] {
            flex-direction: column !important;
            gap: 10px !important;
        }

        button[type="submit"] {
            width: 100% !important;
            height: 45px !important;
            border-radius: 6px !important;
            margin-left: 0 !important;
            font-size: 16px !important;
            font-weight: 600;
        }
        /* Filter controls mobile optimization */
        .filter-controls {
            padding: 10px;
            margin-bottom: 15px;
        }

        .filter-row {
            flex-direction: column;
            align-items: stretch;
            gap: 10px;
        }

        .filter-group {
            min-width: auto;
            width: 100%;
        }

        .filter-select {
            min-width: auto;
            width: 100%;
            height: 45px;
            font-size: 16px;
        }

        .filter-group label {
            font-size: 15px;
            margin-bottom: 8px;
        }
        /* Filter buttons mobile styling */
        .filter-group:last-child {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .filter-btn {
            width: 100%;
            height: 45px;
            font-size: 16px;
            margin: 0;
        }
        /* User grid mobile optimization */
        .user-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 0 10px;
        }

        .user-card {
            padding: 15px;
            margin: 0;
        }

        .user-profile-picture {
            width: 70px;
            height: 70px;
        }

        .user-name {
            font-size: 16px;
        }

        .user-company {
            font-size: 13px;
        }

        .badge-year {
            font-size: 11px;
            padding: 4px 8px;
            top: 8px;
            left: 8px;
        }
        /* Pagination mobile optimization */
        .pagination-controls {
            flex-wrap: wrap;
            gap: 5px;
            padding: 0 10px;
            margin-top: 20px;
        }

        .pagination-btn {
            min-width: 40px;
            height: 40px;
            font-size: 14px;
            padding: 8px 12px;
            margin-bottom: 10px;
        }
            /* Hide ellipsis on very small screens */
            .pagination-btn[style*="background-color: transparent"] {
                display: none;
            }
        /* Pagination info mobile styling */
        div[style*="text-align: center"] {
            padding: 0 10px;
            font-size: 13px;
        }
    }

    /* Extra small mobile devices */
    @@media (max-width: 480px) {
        .large-title {
            font-size: 1.5em;
        }

        .user-grid {
            grid-template-columns: 1fr;
            padding: 0 5px;
        }

        .user-card {
            padding: 12px;
        }

        .user-profile-picture {
            width: 60px;
            height: 60px;
        }

        .pagination-controls {
            justify-content: center;
        }

        .pagination-btn {
            min-width: 35px;
            height: 35px;
            font-size: 12px;
            padding: 6px 8px;
        }
            /* Hide previous/next text on very small screens */
            .pagination-btn:first-child,
            .pagination-btn:last-child {
                font-size: 18px;
            }
    }

    /* Modal popup mobile optimization */
    @@media (max-width: 768px) {
        .pencere-icerik {
            width: 95%;
            height: auto;
            max-height: 90vh;
            margin: 20px auto;
            flex-direction: column;
        }

        .sol-bolum, .sag-bolum {
            padding: 15px;
            border-left: none;
        }

        .sag-bolum {
            border-top: 2px solid #fff;
            border-left: none;
        }

        h2 {
            font-size: 22px;
            margin-bottom: 15px;
        }

        .baglanti {
            width: 90%;
            font-size: 16px;
            margin: 10px 0;
            padding: 12px 20px;
        }

        .kapat-buton {
            width: 35px;
            height: 35px;
            font-size: 24px;
        }
    }
</style>

<!-- Başlık artık aynı satırda ortalanacak; aşağıdaki satır içinde yer alıyor -->

<div class="user-list">
    <form method="get" action="@Url.Action("Firmalar", "Home")" style="margin-bottom: 20px;">
        <div class="firms-header-row">
            <div class="filters-col">
                <div class="filter-controls">
                    <div class="filter-row">
                <div class="filter-group">
                    <label for="provinceFilter">İl:</label>
                    <select asp-for="Province" value="@Model.Province" id="provinceFilter" class="filter-select ">
                        <option value="">Tüm İller</option>

                    </select>
                </div>

                <div class="filter-group">
                    <label for="districtFilter">İlçe:</label>
                    <select asp-for="District" value="@Model.District" id="districtFilter" class="filter-select">
                        <option value="">Tüm İlçeler</option>

                    </select>
                </div>

                <div class="filter-group">
                    <label for="sortByFilter">Sıralama:</label>
                    <select asp-for="SortBy" value="@ViewBag.CurrentSortBy" id="sortByFilter" class="filter-select">
                        <option value="">Varsayılan</option>
                        <option value="company_asc">Firma Adı (A-Z)</option>
                        <option value="company_desc">Firma Adı (Z-A)</option>
                        <option value="announcement_asc">İlan Sayısı (Az-Çok)</option>
                        <option value="announcement_desc">İlan Sayısı (Çok-Az)</option>
                        <option value="date_asc">Üyelik Tarihi (Eski-Yeni)</option>
                        <option value="date_desc">Üyelik Tarihi (Yeni-Eski)</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="sortByFilter">&nbsp&nbsp</label>

                    <button type="submit" class="filter-btn apply-btn">Filtrele</button>
                    @if (!string.IsNullOrEmpty(ViewBag.CurrentSearch as string) ||
                    !string.IsNullOrEmpty(ViewBag.CurrentProvince as string) ||
                    !string.IsNullOrEmpty(ViewBag.CurrentDistrict as string) ||
                    !string.IsNullOrEmpty(ViewBag.CurrentSortBy as string))
                    {
                        <a href="@Url.Action("Firmalar", "Home", new { pageSize = ViewBag.PageSize })"
                           class="filter-btn clear-btn">
                            Temizle
                        </a>
                    }
                </div>
                    </div>
                </div>
            </div>

            <div class="title-col">
                <h1 class="large-title logo">FİRMALAR</h1>
            </div>

            <div class="search-col">
                <!-- Ana Arama Çubuğu -->
                <div class="search-row-wrap">
                    <input type="text"
                           name="search"
                           value="@ViewBag.CurrentSearch"
                           placeholder="Firmaları Arayın..."
                           class="search-input"
                           id="searchInput"
                           style="flex: 1;" />
                    <input type="hidden" value="@ViewBag.PageSize" />
                    <input type="hidden" value="@ViewBag.CurrentProvince" id="CurrentProvince" />
                    <input type="hidden" value="@ViewBag.CurrentDistrict" id="CurrentDistrict" />
                    <input type="hidden" value="@ViewBag.CurrentSortBy" />
                    <button type="submit" class="press-feedback" style="width: auto; height: 40px; border-radius: 0px 6px 6px 0px; margin-left: -10px;">Ara</button>
                </div>
            </div>
        </div>
    </form>

    <ul class="user-grid" id="userGrid" role="list">
        @if (Model != null && Model.Companies != null)
        {
            foreach (var user in Model.Companies)
            {
                <li class="user-card" data-company="@user.CompanyName?.ToUpper()" role="listitem">
                    <div class="badge-year">
                        @if (user is not null)
                        {
                            var membershipMonths = user.CompanyMembershipDuration + 1;
                            if (membershipMonths < 12)
                            {
                                <span>@membershipMonths. Ay</span>
                            }
                            else
                            {
                                var membershipYears = membershipMonths / 12;
                                var remainingMonths = membershipMonths % 12;
                                if (remainingMonths > 0)
                                {
                                    <span>@membershipYears. Yıl @remainingMonths. Ay</span>
                                }
                                else
                                {
                                    <span>@membershipYears. Yıl</span>
                                }
                            }
                        }
                    </div>

                    <div class="img-box loading" aria-hidden="true">
                        <img src="@(string.IsNullOrEmpty(user.ProfilePicturePath) ? "/ImageFiles/kurumsalbosfoto.webp" : user.ProfilePicturePath)"
                             alt="Profil Fotoğrafı"
                             class="user-profile-picture"
                             width="80" height="80"
                             loading="lazy"
                             onload="this.parentElement.classList.remove('loading')"
                             onerror="this.src='/ImageFiles/kurumsalbosfoto.webp'; this.parentElement.classList.remove('loading')" />
                    </div>

                    <p class="user-name">
                        <a class="press-feedback" href="@Url.Action("Details", "Ilan", new { id = user.Id })" target="_blank" rel="noopener noreferrer">@user.CompanyName</a>
                    </p>

                    @{
                        string location = string.Empty;
                        if (!string.IsNullOrEmpty(user.City))
                        {
                            location += user.City;
                        }
                        if (!string.IsNullOrEmpty(user.District))
                        {
                            if (!string.IsNullOrEmpty(location))
                            {
                                location += " / ";
                            }
                            location += user.District;
                        }
                    }

                    <p class="user-location">@location</p>

                    <p class="user-announcement-count">


                        <span class="announcement-minimal">@user.TotalAnnouncement İlan</span>

                    </p>
                    <br />
                    <p class="user-registration-date">
                        Üyelik Tarihi: @user.RegistrationDate?.ToString("dd.MM.yyyy")<br />
                        Firma No: @user.UserOrder
                    </p>
                </li>
            }

        }

    </ul>






</div>


@{
    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
    bool hasPreviousPage = ViewBag.HasPreviousPage ?? false;
    bool hasNextPage = ViewBag.HasNextPage ?? false;
    int pageSize = ViewBag.PageSize ?? 16;
    string currentSearch = ViewBag.CurrentSearch as string;
    string currentProvince = ViewBag.CurrentProvince as string;
    string currentDistrict = ViewBag.CurrentDistrict as string;
    string currentSortBy = ViewBag.CurrentSortBy as string;

    int startPage = Math.Max(1, currentPage - 2);
    int endPage = Math.Min(totalPages, currentPage + 2);


    if (endPage - startPage < 4)
    {
        if (startPage == 1)
        {
            endPage = Math.Min(totalPages, startPage + 4);
        }
        else if (endPage == totalPages)
        {
            startPage = Math.Max(1, endPage - 4);
        }
    }
}



<div class="pagination-controls">
    <!-- Always show pagination for debugging -->
    <!-- Previous Button -->
    @if (hasPreviousPage)
    {
        <a href="@Url.Action("Firmalar", "Home", new { page = currentPage - 1, pageSize = pageSize,
            search = currentSearch, province = currentProvince, district = currentDistrict, sortBy = currentSortBy })"
           class="pagination-btn">‹ Önceki</a>
    }
    else
    {
        <span class="pagination-btn" style="background-color: #ddd; color: #aaa; cursor: not-allowed;">‹ Önceki</span>
    }

    <!-- First page if not in range -->
    @if (startPage > 1)
    {
        <a href="@Url.Action("Firmalar", "Home", new { page = 1, pageSize = pageSize, search = currentSearch, province = currentProvince, district = currentDistrict, sortBy = currentSortBy })"
           class="pagination-btn">1</a>
        @if (startPage > 2)
        {
            <span class="pagination-btn" style="background-color: transparent; border: none; cursor: default;">...</span>
        }
    }

    <!-- Page number buttons -->
    @for (int i = startPage; i <= endPage; i++)
    {
        @if (i == currentPage)
        {
            <span class="pagination-btn active">@i</span>
        }
        else
        {
            <a href="@Url.Action("Firmalar", "Home", new { page = i, pageSize = pageSize, search = currentSearch, province = currentProvince, district = currentDistrict, sortBy = currentSortBy })"
               class="pagination-btn">@i</a>
        }
    }

    <!-- Last page if not in range -->
    @if (endPage < totalPages)
    {
        @if (endPage < totalPages - 1)
        {
            <span class="pagination-btn" style="background-color: transparent; border: none; cursor: default;">...</span>
        }
        <a href="@Url.Action("Firmalar", "Home", new { page = totalPages, pageSize = pageSize, search = currentSearch, province = currentProvince, district = currentDistrict, sortBy = currentSortBy })"
           class="pagination-btn">@totalPages</a>
    }

    <!-- Next Button -->
    @if (hasNextPage)
    {
        <a href="@Url.Action("Firmalar", "Home", new { page = currentPage + 1, pageSize = pageSize, search = currentSearch, province = currentProvince, district = currentDistrict, sortBy = currentSortBy })"
           class="pagination-btn">Sonraki ›</a>
    }
    else
    {
        <span class="pagination-btn" style="background-color: #ddd; color: #aaa; cursor: not-allowed;">Sonraki ›</span>
    }
</div>

<!-- Pagination Info -->
@{
    int totalItems = ViewBag.TotalItems ?? 0;
    int startItem = totalItems > 0 ? ((currentPage - 1) * pageSize) + 1 : 0;
    int endItem = Math.Min(currentPage * pageSize, totalItems);
}

<div style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
    @if (totalItems > 0)
    {
        <span>@startItem - @endItem arası gösteriliyor (Toplam @totalItems firma)</span>
    }
    else
    {
        <span>Firma bulunamadı</span>
    }
</div>


@{
    var totalUserCount = ViewBag.TotalUserCount;
    var firmCounter = ViewBag.TotalFirmCount;

}

@section Scripts {

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Firma ve danışman sayılarını statik placeholder olarak ayarla (daktilo efekti kaldırıldı - performans için)
            var firmCount = parseInt('@firmCounter', 10) || 0;
            var totalUserCount = parseInt('@totalUserCount', 10) || 0;
            var searchInput = document.getElementById('searchInput');
            if (searchInput && !searchInput.value) {
                searchInput.placeholder = firmCount + ' Firma Arasından Arayın...';
            }

            // Sıralama select'ini ViewBag değerine göre ayarla
            var currentSortBy = '@(ViewBag.CurrentSortBy ?? "")';
            if (currentSortBy) {
                var sortBySelect = document.getElementById('sortByFilter');
                if (sortBySelect) {
                    sortBySelect.value = currentSortBy;
                }
            }
        });
    </script>



    <script>
        // API tabanlı il/ilçe yükleme - büyük JSON dosyası yerine
        $(document).ready(function () {
            var currentProvince = $('#CurrentProvince').val();
            var currentDistrict = $('#CurrentDistrict').val();

            // İlleri API'den yükle
            $.ajax({
                url: '/api/provinces',
                method: 'GET',
                dataType: 'json',
                success: function (provinces) {
                    provinces.forEach(function (province) {
                        $('#provinceFilter').append(new Option(province, province));
                    });

                    // Mevcut il seçili ise
                    if (currentProvince) {
                        $('#provinceFilter').val(currentProvince);
                        // İlçeleri yükle
                        loadDistricts(currentProvince, currentDistrict);
                    }
                }
            });

            // İl değiştiğinde ilçeleri yükle
            $('#provinceFilter').change(function () {
                var selectedCity = $(this).val();
                $('#districtFilter').empty().append('<option value="">Tüm İlçeler</option>');

                if (selectedCity) {
                    loadDistricts(selectedCity);
                }
            });

            function loadDistricts(province, selectedDistrict) {
                $.ajax({
                    url: '/api/districts/' + encodeURIComponent(province),
                    method: 'GET',
                    dataType: 'json',
                    success: function (districts) {
                        districts.forEach(function (district) {
                            $('#districtFilter').append(new Option(district, district));
                        });

                        if (selectedDistrict) {
                            $('#districtFilter').val(selectedDistrict);
                        }
                    }
                });
            }
        });
    </script>

}
