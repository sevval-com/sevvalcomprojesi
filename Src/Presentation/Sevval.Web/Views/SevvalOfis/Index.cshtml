@{
    ViewData["Title"] = "≈ûevval Ofis";
    Layout = null;
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <style>
        body {
            background-color: #f0f2f5;
        }

        .sidebar {
            width: 280px;
            min-height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 2rem rgba(0,0,0,0.05);
        }

            .sidebar .nav-link {
                color: #343a40;
                font-size: 0.95rem;
                padding: 0.85rem 1.5rem;
                transition: all 0.2s ease;
                border-left: 4px solid transparent;
                border-radius: 0;
                margin-bottom: 2px;
            }

                .sidebar .nav-link:hover {
                    color: #0d6efd;
                    background-color: #e7f1ff;
                }

                .sidebar .nav-link.active {
                    color: #0d6efd;
                    background-color: #e7f1ff;
                    border-left-color: #0d6efd;
                    font-weight: 500;
                }

                .sidebar .nav-link i {
                    width: 25px;
                    text-align: center;
                    color: #0d6efd;
                }

                .sidebar .nav-link.active i {
                    color: #0d6efd;
                }

            .sidebar .site-home-link {
                background-color: #0d6efd;
                color: white;
                font-weight: bold;
            }

                .sidebar .site-home-link:hover {
                    background-color: #0b5ed7;
                }

        .content {
            width: 100%;
            overflow-y: auto;
            height: 100vh;
        }

        .chart-container {
            height: 400px;
        }

        .sidebar-wrapper {
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .offcanvas .nav-link {
            color: #343a40;
        }

        /* --- G√úN√úN ƒ∞LANI STƒ∞LLERƒ∞ (ADMIN PANEL ƒ∞√áƒ∞N) --- */
        .daily-offer-modal-custom .modal-content {
            background: linear-gradient(135deg, #009cfb 0%, #0056b3 100%);
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            color: white;
            overflow: hidden;
        }

        .daily-offer-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            padding: 0;
            margin: 0;
            aspect-ratio: 1;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1060;
        }

            .daily-offer-close-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.1);
            }

        .daily-offer-left-col {
            padding: 30px;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 30px;
            justify-content: flex-start;
        }

        .daily-offer-right-col {
            padding: 30px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .daily-offer-tags-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .daily-offer-tag {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            white-space: nowrap;
            display: inline-block;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            color: white;
        }

            .daily-offer-tag:hover {
                transform: translateY(-2px) scale(1.05);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }

        .daily-offer-cat {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
            border-color: rgba(255, 255, 255, 0.3);
        }

            .daily-offer-cat::after {
                content: "üèòÔ∏è";
                margin-left: 6px;
            }

        .daily-offer-stat {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-color: rgba(76, 175, 80, 0.5);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

            .daily-offer-stat::after {
                content: "‚úì";
                margin-left: 6px;
                font-weight: bold;
            }

        .daily-offer-subcat {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            border-color: rgba(33, 150, 243, 0.5);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

            .daily-offer-subcat::after {
                content: "üìå";
                margin-left: 6px;
            }

        .daily-offer-price-box {
            margin-bottom: 20px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.2) 100%);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #FFD700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .daily-offer-price-lbl {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .daily-offer-price-val {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
            animation: dailyOfferPriceGlow 2s ease-in-out infinite;
        }

        @@keyframes dailyOfferPriceGlow {
            0%, 100% {
                filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.4)) brightness(1);
            }

            50% {
                filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)) brightness(1.2);
            }
        }

        .daily-offer-title-box .daily-offer-title-text {
            font-size: 22px;
            font-weight: 700;
            margin: 0 0 12px 0;
            line-height: 1.3;
            color: white;
        }

        .daily-offer-loc-box {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            opacity: 0.9;
        }

        .daily-offer-loc-icon {
            color: #01e11b;
        }

        .daily-offer-feat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .daily-offer-feat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.12);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            color: white;
        }

            .daily-offer-feat-item:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(-3px) scale(1.02);
                box-shadow: 0 5px 20px rgba(1, 225, 27, 0.3);
                border-color: #01e11b;
            }

        .daily-offer-feat-icon {
            color: #01e11b;
            width: 20px;
            font-size: 18px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 5px rgba(1, 225, 27, 0.5));
        }

        .daily-offer-feat-item:hover .daily-offer-feat-icon {
            transform: rotate(360deg) scale(1.2);
        }

        .daily-offer-contact-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            margin-top: 0;
        }

        .daily-offer-contact-info {
            margin-bottom: 12px;
        }

        .daily-offer-contact-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .daily-offer-contact-icon {
            color: #01e11b;
            width: 16px;
        }

        .daily-offer-contact-btns {
            display: flex;
            gap: 10px;
        }

        .daily-offer-contact-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .daily-offer-wa-btn {
            background: #25d366;
        }

            .daily-offer-wa-btn:hover {
                background: #128c7e;
                transform: translateY(-2px);
                color: white;
            }

        .daily-offer-call-btn {
            background: #009cfb;
        }

            .daily-offer-call-btn:hover {
                background: #0056b3;
                transform: translateY(-2px);
                color: white;
            }

        .daily-offer-slider-wrap {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.15);
            height: 450px;
            position: relative;
        }

        .swiper-slide {
            background: rgba(0,0,0,0.2);
        }

        .daily-offer-slider-wrap .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .daily-offer-action-box {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .daily-offer-action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            width: 100%;
        }

        .daily-offer-btn-primary {
            background: linear-gradient(135deg, #01e11b 0%, #00c41a 100%);
            box-shadow: 0 4px 12px rgba(1, 225, 27, 0.3);
        }

            .daily-offer-btn-primary:hover {
                background: linear-gradient(135deg, #00c41a 0%, #00a015 100%);
                transform: translateY(-3px) scale(1.02);
                color: white;
                border-color: rgba(255, 255, 255, 0.5);
            }

        .daily-offer-btn-orange {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

            .daily-offer-btn-orange:hover {
                background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
                transform: translateY(-3px) scale(1.02);
                color: white;
                border-color: rgba(255, 255, 255, 0.5);
            }

        .daily-offer-view-cnt {
            grid-column: span 2;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 18px;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            width: 100%;
        }

            .daily-offer-view-cnt:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: translateY(-2px);
            }

        .daily-offer-modal-custom .swiper-button-prev,
        .daily-offer-modal-custom .swiper-button-next {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

            .daily-offer-modal-custom .swiper-button-prev:after,
            .daily-offer-modal-custom .swiper-button-next:after {
                font-size: 24px;
                font-weight: bold;
            }

        /* MOBƒ∞L RESPONSIVE */
        @@media (max-width: 768px) {
            .modal-lg-custom {
                max-width: 92% !important;
                margin: 15px auto !important;
                max-height: 90vh !important;
            }

            .daily-offer-modal-custom .modal-content {
                max-height: 85vh !important;
                overflow-y: auto !important;
            }

            .daily-offer-left-col {
                padding: 10px !important;
                overflow-y: visible !important;
                max-height: none !important;
                gap: 8px !important;
            }

            .daily-offer-right-col {
                padding: 5px 10px !important;
                gap: 5px !important;
            }

            .daily-offer-slider-wrap {
                height: 200px !important;
                border-radius: 10px !important;
            }

            .daily-offer-price-val {
                font-size: 22px !important;
            }

            .daily-offer-price-lbl {
                font-size: 10px !important;
                margin-bottom: 2px !important;
            }

            .daily-offer-price-box {
                padding: 8px !important;
                margin-bottom: 8px !important;
            }

            .daily-offer-title-text {
                font-size: 16px !important;
                margin-bottom: 5px !important;
                line-height: 1.2 !important;
            }

            .daily-offer-title-box {
                margin-bottom: 0 !important;
            }

            .daily-offer-loc-box {
                font-size: 11px !important;
                margin-bottom: 8px !important;
            }

            .daily-offer-tags-wrapper {
                margin-bottom: 8px !important;
                gap: 4px !important;
            }

            .daily-offer-tag {
                padding: 4px 8px !important;
                font-size: 9px !important;
            }

            .daily-offer-feat-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 5px !important;
                margin-bottom: 8px !important;
            }

            .daily-offer-feat-item {
                padding: 5px !important;
                font-size: 10px !important;
            }

            .daily-offer-feat-icon {
                font-size: 14px !important;
            }

            .daily-offer-contact-box {
                padding: 8px !important;
                margin-top: 0 !important;
            }

            .daily-offer-contact-row {
                font-size: 11px !important;
                margin-bottom: 4px !important;
            }

            .daily-offer-contact-btn {
                padding: 6px 10px !important;
                font-size: 11px !important;
            }

            .daily-offer-contact-btns {
                gap: 5px !important;
            }

            .daily-offer-action-box {
                gap: 5px !important;
                margin-top: 10px !important;
            }

            .daily-offer-action-btn {
                padding: 8px !important;
                font-size: 11px !important;
            }

            .daily-offer-view-cnt {
                padding: 5px !important;
                font-size: 11px !important;
                margin-top: 0 !important;
            }

            .daily-offer-close-btn {
                width: 30px !important;
                height: 30px !important;
                top: 10px !important;
                right: 10px !important;
                font-size: 14px !important;
            }
        }

    </style>
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar-wrapper d-none d-lg-block" id="sidebar">
            <nav class="sidebar p-3 h-100">
                <div class="text-center py-3">
                    <img src="~/images/favlogo.webp" alt="≈ûevval Ofis Logo" class="img-fluid mb-3" style="max-width: 100px;">
                    <h4 class="fw-bold text-primary">≈ûevval Ofis</h4>
                </div>
                <hr>
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="@Url.Action("Index", "SevvalOfis")"><i class="bi bi-pie-chart-fill me-2"></i> √ñzet</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Uyelikler", "SevvalOfis")"><i class="bi bi-people-fill me-2"></i> √úyelikler</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("SehirlereGoreEmlakcilar", "SevvalOfis")"><i class="bi bi-building me-2"></i> ≈ûehirlere G√∂re Emlak√ßƒ±lar</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("BireyselKullanicilar", "SevvalOfis")"><i class="bi bi-person-fill me-2"></i> Bireysel Kullanƒ±cƒ±lar</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Index", "IlanYonetim")"><i class="bi bi-clipboard2-data-fill me-2"></i> ƒ∞lan Y√∂netimi</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Index", "IlanTakip")"><i class="bi bi-search me-2"></i> Bireysel ƒ∞lan Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("TumIlanlar", "SevvalOfis")"><i class="bi bi-list-ul me-2"></i> T√ºm ƒ∞lanlar</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-diagram-3-fill me-2"></i> Karde≈ü Firma Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("IlanTalepTakip", "SevvalOfis")"><i class="bi bi-card-list me-2"></i> ƒ∞lan Talep Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("GununIlaniTakip", "SevvalOfis")"><i class="bi bi-calendar-event-fill me-2"></i> G√ºn√ºn ƒ∞lanƒ± Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("AfisTalepler", "SevvalOfis")"><i class="bi bi-card-checklist me-2"></i> Afi≈ü Talepleri</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("MailGonder", "SevvalOfis")"><i class="bi bi-envelope-fill me-2"></i> Mail G√∂nder</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("SmsMesaj", "SevvalOfis")"><i class="bi bi-chat-dots-fill me-2"></i> SMS Mesaj</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("EidsOnayliKullanicilar", "SevvalOfis")"><i class="bi bi-check-circle me-2"></i> Eƒ∞DS Onaylƒ± Kullanƒ±cƒ±lar</a></li>
                    <li class="nav-item mt-auto"><a class="nav-link site-home-link text-center" href="/"><i class="bi bi-house-door-fill me-2"></i> Siteye Geri D√∂n</a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="content p-4">
            <div class="d-flex align-items-center mb-4">
                <button class="btn btn-primary d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
                    <i class="bi bi-list"></i>
                </button>
                <h1 class="display-5 fw-bold mb-0 ms-3">Genel Bakƒ±≈ü</h1>
            </div>

            <div class="row g-4">
                <div class="col-lg-4">
                    <div class="card shadow-sm h-100 border-0 rounded-3">
                        <div class="card-body">
                            <h5 class="card-title text-center text-primary">√úye T√ºrleri</h5>
                            <div id="userTypeChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card shadow-sm h-100 border-0 rounded-3">
                        <div class="card-body">
                            <h5 class="card-title text-center text-primary">ƒ∞lan Durumlarƒ±</h5>
                            <div id="propertyStatusChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card shadow-sm h-100 border-0 rounded-3">
                        <div class="card-body">
                            <h5 class="card-title text-center text-primary">√úyelik Tipleri</h5>
                            <div id="subscriptionChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (ViewBag.GununIlan != null)
    {
        <script>
            (function() {
                async function refreshDailyOfferViewCount() {
                    try {
                        const response = await fetch('@Url.Action("GetDailyOfferViewCount", "Home")', { cache: 'no-store' });
                        if (!response.ok) return;
                        const data = await response.json();
                        if (data && data.success) {
                            const el = document.getElementById('dailyOfferViewCountText');
                            if (el) {
                                el.innerHTML = data.count + ' g√∂r√ºnt√ºlenme';
                            }
                        }
                    } catch (e) { }
                }
                refreshDailyOfferViewCount();
                setInterval(refreshDailyOfferViewCount, 60000);
            })();
        </script>

        <!-- Bootstrap 5 Modal - G√ºn√ºn ƒ∞lanƒ± (Admin Panel) -->
        <div class="modal fade daily-offer-modal-custom" id="dailyOfferModal" tabindex="-1" aria-labelledby="dailyOfferLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg-custom">
                <div class="modal-content">
                    <!-- Close Button -->
                    <button type="button" class="daily-offer-close-btn" data-bs-dismiss="modal" aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="modal-body p-0">
                        <div class="row g-0">
                            <!-- Sol Taraf: Bilgiler -->
                            <div class="col-lg-5 col-12 order-2 order-lg-1">
                                <div class="daily-offer-left-col">
                                    <div>
                                        <!-- Tags -->
                                        <div class="daily-offer-tags-wrapper">
                                            @{
                                                var category = string.IsNullOrWhiteSpace(ViewBag.GununIlan.Category) ? "" : ViewBag.GununIlan.Category;
                                                var status = string.IsNullOrWhiteSpace(ViewBag.GununIlan.KonutDurumu) ? "" : ViewBag.GununIlan.KonutDurumu;
                                                var subCategory = string.IsNullOrWhiteSpace(ViewBag.GununIlan.MulkTipi) ? "" : ViewBag.GununIlan.MulkTipi;
                                            }

                                            @if (!string.IsNullOrEmpty(category))
                                            {
                                                <span class="daily-offer-tag daily-offer-cat">@category</span>
                                            }
                                            @if (!string.IsNullOrEmpty(status))
                                            {
                                                <span class="daily-offer-tag daily-offer-stat">@status</span>
                                            }
                                            @if (!string.IsNullOrEmpty(subCategory))
                                            {
                                                <span class="daily-offer-tag daily-offer-subcat">@subCategory</span>
                                            }
                                        </div>

                                        <!-- Price -->
                                        <div class="daily-offer-price-box">
                                            <div class="daily-offer-price-lbl">Fiyat</div>
                                            <div class="daily-offer-price-val">@($"{ViewBag.GununIlan.Price:N0} TL")</div>
                                        </div>

                                        <!-- Title -->
                                        <div class="daily-offer-title-box">
                                            <h2 class="daily-offer-title-text">@ViewBag.GununIlan.Title</h2>
                                        </div>

                                        <!-- Location -->
                                        @{
                                            List<string> locationList = new List<string>();
                                            locationList.Add(ViewBag.GununIlan.sehir);
                                            locationList.Add(ViewBag.GununIlan.semt);
                                            locationList.Add(ViewBag.GununIlan.mahalleKoy);
                                        }
                                        <div class="daily-offer-loc-box">
                                            <i class="fas fa-map-marker-alt daily-offer-loc-icon"></i>
                                            <span>@string.Join(" | ", locationList.Where(a => !string.IsNullOrEmpty(a)))</span>
                                        </div>

                                        <!-- Details Grid (Dolu/Bo≈ü Kontroll√º) -->
                                        <div class="daily-offer-feat-grid">
                                            @if (!string.IsNullOrEmpty(ViewBag.GununIlan.Area?.ToString()) && ViewBag.GununIlan.Area?.ToString() != "0")
                                            {
                                                <div class="daily-offer-feat-item">
                                                    <i class="fas fa-ruler-combined daily-offer-feat-icon"></i>
                                                    <span>@ViewBag.GununIlan.Area?.ToString("N0") m¬≤</span>
                                                </div>
                                            }
                                            @if (!string.IsNullOrEmpty(ViewBag.GununIlan.AdaNo?.ToString()))
                                            {
                                                <div class="daily-offer-feat-item">
                                                    <i class="fas fa-map daily-offer-feat-icon"></i>
                                                    <span>Ada: @ViewBag.GununIlan.AdaNo</span>
                                                </div>
                                            }
                                            @if (!string.IsNullOrEmpty(ViewBag.GununIlan.ParselNo?.ToString()))
                                            {
                                                <div class="daily-offer-feat-item">
                                                    <i class="fas fa-map daily-offer-feat-icon"></i>
                                                    <span>Parsel: @ViewBag.GununIlan.ParselNo</span>
                                                </div>
                                            }
                                            @if (!string.IsNullOrEmpty(ViewBag.GununIlan.OdaSayisi?.ToString()) && ViewBag.GununIlan.OdaSayisi?.ToString() != "0")
                                            {
                                                <div class="daily-offer-feat-item">
                                                    <i class="fas fa-bed daily-offer-feat-icon"></i>
                                                    <span>@ViewBag.GununIlan.OdaSayisi Oda</span>
                                                </div>
                                            }
                                            @if (!string.IsNullOrEmpty(ViewBag.GununIlan.BinaYasi?.ToString()))
                                            {
                                                <div class="daily-offer-feat-item">
                                                    <i class="fas fa-building daily-offer-feat-icon"></i>
                                                    <span>@ViewBag.GununIlan.BinaYasi Ya≈üƒ±nda</span>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <!-- Contact Section (Firma Adƒ± Eklendi) -->
                                    <div class="daily-offer-contact-box">
                                        <div class="daily-offer-contact-info">
                                            <div class="daily-offer-contact-row">
                                                <i class="fas fa-user daily-offer-contact-icon"></i>
                                                <span>@ViewBag.KullaniciAdSoyad</span>
                                            </div>
                                            <div class="daily-offer-contact-row">
                                                <i class="fas fa-phone daily-offer-contact-icon"></i>
                                                @{
                                                    string rawPhone = (ViewBag.GununIlan.PhoneNumber ?? "").ToString();
                                                    var sbPhone = new System.Text.StringBuilder();
                                                    foreach (var ch in rawPhone)
                                                    {
                                                        if (char.IsDigit(ch)) sbPhone.Append(ch);
                                                    }
                                                    string digits = sbPhone.ToString();
                                                    if (digits.StartsWith("90") && digits.Length == 12)
                                                    {
                                                        digits = "0" + digits.Substring(2);
                                                    }
                                                    if (digits.Length == 10)
                                                    {
                                                        digits = "0" + digits;
                                                    }
                                                    string formattedPhone = rawPhone;
                                                    if (digits.Length >= 11)
                                                    {
                                                        formattedPhone = $"0 {digits.Substring(1, 3)} {digits.Substring(4, 3)} {digits.Substring(7, 2)} {digits.Substring(9, 2)}";
                                                    }
                                                }
                                                <span>@formattedPhone</span>
                                            </div>
                                            @if (!string.IsNullOrEmpty(ViewBag.CompanyName))
                                            {
                                                <div class="daily-offer-contact-row">
                                                    <i class="fas fa-building daily-offer-contact-icon"></i>
                                                    <span>@ViewBag.CompanyName</span>
                                                </div>
                                            }
                                        </div>
                                        <div class="daily-offer-contact-btns">
                                            <a href="javascript:void(0)" class="daily-offer-contact-btn daily-offer-wa-btn" onclick="sendMessageToWhatsapp()">
                                                <i class="fab fa-whatsapp"></i> WhatsApp
                                            </a>
                                            <a href="javascript:void(0)" class="daily-offer-contact-btn daily-offer-call-btn" onclick="makeCall()">
                                                <i class="fas fa-phone"></i> Ara
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Saƒü Taraf: Slider ve Aksiyon Butonlarƒ± -->
                            <div class="col-lg-7 col-12 order-1 order-lg-2">
                                <div class="daily-offer-right-col">
                                    <!-- Swiper Container (Benzersiz ID) -->
                                    <div class="daily-offer-slider-wrap">
                                        <div class="swiper dailyOfferSwiper w-100 h-100">
                                            <div class="swiper-wrapper">
                                                @if (ViewBag.Fotograflar != null && ViewBag.Fotograflar.Count > 0)
                                                {
                                                    bool gununIlaniEklendi = false;
                                                    for (int i = 0; i < ViewBag.Fotograflar.Count; i++)
                                                    {
                                                        string photoUrl = ViewBag.Fotograflar[i].Url.ToString();
                                                        if (photoUrl.Contains("wwwroot"))
                                                        {
                                                            int idx = photoUrl.IndexOf("wwwroot");
                                                            photoUrl = photoUrl.Substring(idx + 8).Replace("\\", "/");
                                                            if (!photoUrl.StartsWith("/")) photoUrl = "/" + photoUrl;
                                                        }
                                                        else if (photoUrl.Contains("images"))
                                                        {
                                                            int idx = photoUrl.IndexOf("images");
                                                            photoUrl = "/" + photoUrl.Substring(idx).Replace("\\", "/");
                                                        }

                                                        <div class="swiper-slide">
                                                            <img src="@photoUrl" alt="ƒ∞lan Resmi" loading="lazy" style="object-fit: contain;" />
                                                        </div>

                                                        if (!gununIlaniEklendi && i == (ViewBag.Fotograflar.Count / 2))
                                                        {
                                                            <div class="swiper-slide">
                                                                <img src="~/ImageFiles/gununilani.png" alt="G√ºn√ºn ƒ∞lanƒ±" loading="lazy" style="object-fit: contain;" />
                                                            </div>
                                                            gununIlaniEklendi = true;
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    <div class="swiper-slide d-flex align-items-center justify-content-center text-white">
                                                        <div class="text-center">
                                                            <i class="fas fa-camera fa-3x mb-2"></i>
                                                            <p>Fotoƒüraf Yok</p>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                            <div class="swiper-button-next"></div>
                                            <div class="swiper-button-prev"></div>
                                        </div>
                                    </div>

                                    <!-- Alt Aksiyon Butonlarƒ± -->
                                    <div class="daily-offer-action-box">
                                        <a href="@Url.Action("ilansayfasi", "Ilan", new { id = ViewBag.GununIlan.Id })" class="daily-offer-action-btn daily-offer-btn-primary">
                                            <i class="fas fa-eye"></i> ƒ∞lana Git
                                        </a>
                                        <a href="@Url.Action("GununIlaniSiparisi", "Home")" class="daily-offer-action-btn daily-offer-btn-orange">
                                            <i class="fas fa-star"></i> G√ºn√ºn ƒ∞lanƒ± Ver
                                        </a>
                                        <div class="daily-offer-view-cnt">
                                            <i class="fas fa-eye"></i>
                                            <span id="dailyOfferViewCountText">@ViewBag.GununIlan.GoruntulenmeSayisi g√∂r√ºnt√ºlenme</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Sidebar for mobile -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-primary fw-bold">≈ûevval Ofis</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body p-0">
            <nav class="h-100">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="@Url.Action("Index", "SevvalOfis")"><i class="bi bi-pie-chart-fill me-2"></i> √ñzet</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Uyelikler", "SevvalOfis")"><i class="bi bi-people-fill me-2"></i> √úyelikler</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("SehirlereGoreEmlakcilar", "SevvalOfis")"><i class="bi bi-building me-2"></i> ≈ûehirlere G√∂re Emlak√ßƒ±lar</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("BireyselKullanicilar", "SevvalOfis")"><i class="bi bi-person-fill me-2"></i> Bireysel Kullanƒ±cƒ±lar</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Index", "IlanYonetim")"><i class="bi bi-clipboard2-data-fill me-2"></i> ƒ∞lan Y√∂netimi</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Index", "IlanTakip")"><i class="bi bi-search me-2"></i> Bireysel ƒ∞lan Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("IlanTalepTakip", "SevvalOfis")"><i class="bi bi-card-list me-2"></i> ƒ∞lan Talep Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("GununIlaniTakip", "SevvalOfis")"><i class="bi bi-calendar-event-fill me-2"></i> G√ºn√ºn ƒ∞lanƒ± Takip</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("AfisTalepler", "SevvalOfis")"><i class="bi bi-card-checklist me-2"></i> Afi≈ü Talepleri</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("MailGonder", "SevvalOfis")"><i class="bi bi-envelope-fill me-2"></i> Mail G√∂nder</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("SmsMesaj", "SevvalOfis")"><i class="bi bi-chat-dots-fill me-2"></i> SMS Mesaj</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("EidsOnayliKullanicilar", "SevvalOfis")"><i class="bi bi-check-circle me-2"></i> Eƒ∞DS Onaylƒ± Kullanƒ±cƒ±lar</a></li>
                    <li class="nav-item mt-auto p-3"><a class="nav-link site-home-link text-center" href="/"><i class="bi bi-house-door-fill me-2"></i> Siteye Geri D√∂n</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Chart Data from ViewBag
            var corporateCount = @ViewBag.CorporateCount;
            var bankCount = @ViewBag.BankCount;
            var buildingCount = @ViewBag.BuildingCount;
            var foundationCount = @ViewBag.FoundationCount;
            var individualCount = @ViewBag.IndividualCount;
            var paidCount = @ViewBag.PaidCount;
            var freeCount = @ViewBag.FreeCount;
            var propertyStatusData = @Html.Raw(Json.Serialize(ViewBag.PropertyStatusCounts));

            // ECharts instances
            var userTypeChart = echarts.init(document.getElementById('userTypeChart'));
            var propertyStatusChart = echarts.init(document.getElementById('propertyStatusChart'));
            var subscriptionChart = echarts.init(document.getElementById('subscriptionChart'));

            const blueColor = '#0d6efd';

            // Base Chart Options for Bar Charts
            const baseBarChartOption = {
                tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
                grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
                xAxis: { type: 'category', data: [], axisLabel: { interval: 0, rotate: 30 } },
                yAxis: { type: 'value' },
                series: [{
                    data: [],
                    type: 'bar',
                    barWidth: '60%',
                    itemStyle: {
                        color: blueColor
                    }
                }]
            };

            // User Type Chart (Bar)
            var userTypeData = [
                { value: corporateCount, name: 'Kurumsal' }, { value: individualCount, name: 'Bireysel' },
                { value: bankCount, name: 'Banka' }, { value: buildingCount, name: 'ƒ∞n≈üaat' },
                { value: foundationCount, name: 'Vakƒ±f' }
            ].filter(d => d.value > 0);

            let userTypeOption = JSON.parse(JSON.stringify(baseBarChartOption));
            userTypeOption.xAxis.data = userTypeData.map(item => item.name);
            userTypeOption.series[0].data = userTypeData.map(item => item.value);
            userTypeChart.setOption(userTypeOption);

            // Property Status Chart (Bar)
            let propertyStatusFilteredData = propertyStatusData.filter(item => item.value > 0);
            let propertyStatusOption = JSON.parse(JSON.stringify(baseBarChartOption));
            propertyStatusOption.xAxis.data = propertyStatusFilteredData.map(item => item.name);
            propertyStatusOption.series[0].data = propertyStatusFilteredData.map(item => item.value);
            propertyStatusChart.setOption(propertyStatusOption);

            // Subscription Chart (Donut)
            var subscriptionOption = {
                tooltip: { trigger: 'item' },
                legend: { top: 'bottom' },
                color: ['#0d6efd', '#9ec5fe'],
                series: [{
                    name: '√úyelik Tipi',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    avoidLabelOverlap: false,
                    label: { show: false, position: 'center' },
                    emphasis: { label: { show: true, fontSize: '20', fontWeight: 'bold' } },
                    labelLine: { show: false },
                    data: [ { value: paidCount, name: '√úcretli' }, { value: freeCount, name: '√úcretsiz' } ].filter(d => d.value > 0)
                }]
            };
            subscriptionChart.setOption(subscriptionOption);

            window.addEventListener('resize', () => {
                userTypeChart.resize();
                propertyStatusChart.resize();
                subscriptionChart.resize();
            });
        });
    </script>
</body>
</html>

